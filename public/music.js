"use strict";

////////////////////////////////////////////////////////////////////////////////////////////////////
// base ////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////
var app = {};
var ui = {};
var $ui = {};
var cue = {}; // TODO: mover para lugar apropriado

$(function () {
  $ui["library"] = $(".library");
});

var duration = function duration(seconds) {
  return moment.utc(moment.duration(seconds, "seconds").asMilliseconds()).format("m:ss");
}; ////////////////////////////////////////////////////////////////////////////////////////////////////
// core / template engine //////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////


ui.template = function () {
  var $templates = {};
  $(function () {
    $("template").each(function () {
      var $this = $(this);
      var name = $this.attr("id");
      var html = $this.html();
      $templates[name] = $(html);
      $this.remove();
    });
  });

  var render = function render(template, data) {
    if (!$templates[template]) {
      return false;
    }

    var $render = $templates[template].clone();
    $render.data(data);

    $.fn.fillBlanks = function () {
      var $blank = $(this);
      var fill = $blank.data("fill");
      var rules = fill.split(",");

      for (var i = 0; i < rules.length; i++) {
        var pair = rules[i].split(":");
        var dest = pair[1] ? pair[0].trim() : "html";
        var source = pair[1] ? pair[1].trim() : pair[0];
        var value = data[source];
        source = source.split("/");

        if (source.length > 1 && typeof value !== "undefined") {
          value = data[source[0]];

          for (var j = 1; j < source.length; j++) {
            value = value[source[j]] ? value[source[j]] : null;
          }
        }

        if (typeof value !== "undefined" && value !== null) {
          if (dest === "class") {
            $blank.addClass(value);
          } else if (dest === "html") {
            $blank.html(value);
          } else if (dest === "value") {
            $blank.val(value);
          } else {
            $blank.attr(dest, value);
          }
        } else {
          var if_null = $blank.data("fill-null");

          if (if_null === "hide") {
            $blank.hide();
          } else if (if_null === "remove") {
            $blank.remove();
          }
        }
      }

      $blank.removeClass("fill").removeAttr("data-fill").removeAttr("data-fill-null");
    };

    if ($render.hasClass("fill")) {
      $render.fillBlanks();
    }

    $(".fill", $render).each(function () {
      $(this).fillBlanks();
    });
    return $render;
  };

  return {
    render: render
  };
}();

var __render = ui.template.render; ////////////////////////////////////////////////////////////////////////////////////////////////////
// player //////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

var $player;
var $np = {};
$(function () {
  $player = document.querySelector("audio.player");
  $np.position = $(".now-playing .position");
  $np.length = $(".now-playing .length");
  $np.timeline = $(".now-playing .bar");
  $np.elapsed = $(".now-playing .elapsed");
  $player.addEventListener("timeupdate", function (event) {
    var length = duration($player.duration);
    $np.length.text(length);
    var position = duration($player.currentTime);
    $np.position.text(position);
    var percent = $player.currentTime / $player.duration * 100;
    $np.elapsed.css("width", percent + "%"); // console.log(position_is_seconds, human_position);
  });
  $ui["now-playing"] = $(".now-playing");
  $(".play", $ui["now-playing"]).on("click", app.Player.playPause); // Cliques na linha do tempo

  $np.timeline.on("click", function (event) {
    var width = $(event.delegateTarget).width();
    var position = event.offsetX;
    var percent = position / width;
    var position_in_seconds = $player.duration * percent;
    app.Player.skipToPosition(position_in_seconds);
  });
});

app.Player = function () {
  // const updateTimeline
  ////////////////////////////////////////////////////////////////////////////////////////////////
  // app.Player.skipToPosition()
  var skipToPosition = function skipToPosition(seconds) {
    $player.currentTime = seconds;
  }; ////////////////////////////////////////////////////////////////////////////////////////////////
  // app.Player.play()


  var play = function play() {
    $player.play();
  }; ////////////////////////////////////////////////////////////////////////////////////////////////
  // app.Player.pause()


  var pause = function pause() {
    $player.pause();
  }; ////////////////////////////////////////////////////////////////////////////////////////////////
  // app.Player.playPause()


  var playPause = function playPause() {
    if ($player.paused) {
      $player.play();
    } else {
      $player.pause();
    } // console.log("duration", $player.duration);
    // console.log("volume", $player.volume);
    // console.log("buffered", $player.buffered);
    // console.log("networkState", $player.networkState);
    // console.log("played", $player.played);
    // console.log("readyState", $player.readyState);
    // console.log("seekable", $player.seekable);

  }; ////////////////////////////////////////////////////////////////////////////////////////////////


  return {
    skipToPosition: skipToPosition,
    play: play,
    pause: pause,
    playPause: playPause
  };
}(); ////////////////////////////////////////////////////////////////////////////////////////////////////
// artist //////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////


app.Artist = function () {
  ////////////////////////////////////////////////////////////////////////////////////////////////
  // app.Artist.load()
  var load = function load(artist_id) {
    $.get("data/artists/" + artist_id + ".json").done(function (response) {
      var artist = response;

      var $artist = __render("artist", artist); // Álbuns


      var albums = artist["albums"];
      var $albums = $(".albums", $artist);
      albums.forEach(function (album) {
        album["cover-art"] = "background-image: url('" + album["cover"] + "')";

        var $album = __render("artist-album", album).appendTo($albums);
      }); // Hits

      var hits = artist["hits"];
      var $hits = $(".hits", $artist);
      hits.forEach(function (hit) {
        hit["formatted-length"] = duration(hit["length"]);

        var $hit = __render("artist-hit", hit).appendTo($hits);
      }); // Coloca na tela

      $ui["library"].empty().append($artist);
    });
  }; ////////////////////////////////////////////////////////////////////////////////////////////////


  return {
    load: load
  };
}(); ////////////////////////////////////////////////////////////////////////////////////////////////////
// start ///////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////


$(function () {
  app.Artist.load("the-beatles");
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJhc2UuanMiLCJ0ZW1wbGF0ZS1lbmdpbmUuanMiLCJwbGF5ZXIuanMiLCJhcnRpc3QuanMiLCJzdGFydC5qcyJdLCJuYW1lcyI6WyJhcHAiLCJ1aSIsIiR1aSIsImN1ZSIsIiQiLCJkdXJhdGlvbiIsInNlY29uZHMiLCJtb21lbnQiLCJ1dGMiLCJhc01pbGxpc2Vjb25kcyIsImZvcm1hdCIsInRlbXBsYXRlIiwiJHRlbXBsYXRlcyIsImVhY2giLCIkdGhpcyIsIm5hbWUiLCJhdHRyIiwiaHRtbCIsInJlbW92ZSIsInJlbmRlciIsImRhdGEiLCIkcmVuZGVyIiwiY2xvbmUiLCJmbiIsImZpbGxCbGFua3MiLCIkYmxhbmsiLCJmaWxsIiwicnVsZXMiLCJzcGxpdCIsImkiLCJsZW5ndGgiLCJwYWlyIiwiZGVzdCIsInRyaW0iLCJzb3VyY2UiLCJ2YWx1ZSIsImoiLCJhZGRDbGFzcyIsInZhbCIsImlmX251bGwiLCJoaWRlIiwicmVtb3ZlQ2xhc3MiLCJyZW1vdmVBdHRyIiwiaGFzQ2xhc3MiLCJfX3JlbmRlciIsIiRwbGF5ZXIiLCIkbnAiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJwb3NpdGlvbiIsInRpbWVsaW5lIiwiZWxhcHNlZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsInRleHQiLCJjdXJyZW50VGltZSIsInBlcmNlbnQiLCJjc3MiLCJvbiIsIlBsYXllciIsInBsYXlQYXVzZSIsIndpZHRoIiwiZGVsZWdhdGVUYXJnZXQiLCJvZmZzZXRYIiwicG9zaXRpb25faW5fc2Vjb25kcyIsInNraXBUb1Bvc2l0aW9uIiwicGxheSIsInBhdXNlIiwicGF1c2VkIiwiQXJ0aXN0IiwibG9hZCIsImFydGlzdF9pZCIsImdldCIsImRvbmUiLCJyZXNwb25zZSIsImFydGlzdCIsIiRhcnRpc3QiLCJhbGJ1bXMiLCIkYWxidW1zIiwiZm9yRWFjaCIsImFsYnVtIiwiJGFsYnVtIiwiYXBwZW5kVG8iLCJoaXRzIiwiJGhpdHMiLCJoaXQiLCIkaGl0Iiwi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RSxNQUFBLENBQUFDLElBQUEsQ0FBQSxhQUFBO0FBQ0EsQ0FGQSxDQUFBIiwiZmlsZSI6Im11c2ljLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4vLyBiYXNlIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcbmxldCBhcHAgPSB7IH07XHJcblxyXG5sZXQgdWkgPSB7IH07XHJcbmxldCAkdWkgPSB7IH07XHJcblxyXG5sZXQgY3VlID0geyB9O1xyXG5cclxuXHJcblxyXG5cclxuLy8gVE9ETzogbW92ZXIgcGFyYSBsdWdhciBhcHJvcHJpYWRvXHJcbiQoZnVuY3Rpb24oKSB7XHJcbiAgICAkdWlbXCJsaWJyYXJ5XCJdID0gJChcIi5saWJyYXJ5XCIpO1xyXG59KTtcclxuXHJcbmNvbnN0IGR1cmF0aW9uID0gKHNlY29uZHMpID0+IHtcclxuICAgIHJldHVybiBtb21lbnQudXRjKG1vbWVudC5kdXJhdGlvbihzZWNvbmRzLCBcInNlY29uZHNcIikuYXNNaWxsaXNlY29uZHMoKSkuZm9ybWF0KFwibTpzc1wiKTtcclxufTtcclxuIiwiLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4vLyBjb3JlIC8gdGVtcGxhdGUgZW5naW5lIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcbnVpLnRlbXBsYXRlID0gKCgpID0+IHtcclxuICAgIGxldCAkdGVtcGxhdGVzID0geyB9O1xyXG5cclxuICAgICQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICQoXCJ0ZW1wbGF0ZVwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTtcclxuICAgICAgICAgICAgdmFyIG5hbWUgPSAkdGhpcy5hdHRyKFwiaWRcIik7XHJcbiAgICAgICAgICAgIHZhciBodG1sID0gJHRoaXMuaHRtbCgpO1xyXG5cclxuICAgICAgICAgICAgJHRlbXBsYXRlc1tuYW1lXSA9ICQoaHRtbCk7XHJcbiAgICAgICAgICAgICR0aGlzLnJlbW92ZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgcmVuZGVyID0gKHRlbXBsYXRlLCBkYXRhKSA9PiB7XHJcbiAgICAgICAgaWYgKCEkdGVtcGxhdGVzW3RlbXBsYXRlXSkgeyByZXR1cm4gZmFsc2U7IH1cclxuICAgICAgICB2YXIgJHJlbmRlciA9ICR0ZW1wbGF0ZXNbdGVtcGxhdGVdLmNsb25lKCk7XHJcblxyXG4gICAgICAgICRyZW5kZXIuZGF0YShkYXRhKTtcclxuXHJcbiAgICAgICAgJC5mbi5maWxsQmxhbmtzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgJGJsYW5rID0gJCh0aGlzKTtcclxuICAgICAgICAgICAgdmFyIGZpbGwgPSAkYmxhbmsuZGF0YShcImZpbGxcIik7XHJcblxyXG4gICAgICAgICAgICB2YXIgcnVsZXMgPSBmaWxsLnNwbGl0KFwiLFwiKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBydWxlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHBhaXIgPSBydWxlc1tpXS5zcGxpdChcIjpcIik7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVzdCA9IChwYWlyWzFdID8gcGFpclswXS50cmltKCkgOiBcImh0bWxcIik7XHJcbiAgICAgICAgICAgICAgICB2YXIgc291cmNlID0gKHBhaXJbMV0gPyBwYWlyWzFdLnRyaW0oKSA6IHBhaXJbMF0pO1xyXG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gZGF0YVtzb3VyY2VdO1xyXG5cclxuICAgICAgICAgICAgICAgIHNvdXJjZSA9IHNvdXJjZS5zcGxpdChcIi9cIik7XHJcbiAgICAgICAgICAgICAgICBpZiAoc291cmNlLmxlbmd0aCA+IDEgJiYgdHlwZW9mIHZhbHVlICE9PSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBkYXRhW3NvdXJjZVswXV07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAxOyBqIDwgc291cmNlLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gKHZhbHVlW3NvdXJjZVtqXV0pID8gdmFsdWVbc291cmNlW2pdXSA6IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09IFwidW5kZWZpbmVkXCIgJiYgdmFsdWUgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGVzdCA9PT0gXCJjbGFzc1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRibGFuay5hZGRDbGFzcyh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkZXN0ID09PSBcImh0bWxcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkYmxhbmsuaHRtbCh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkZXN0ID09PSBcInZhbHVlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGJsYW5rLnZhbCh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGJsYW5rLmF0dHIoZGVzdCwgdmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlmX251bGwgPSAkYmxhbmsuZGF0YShcImZpbGwtbnVsbFwiKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaWZfbnVsbCA9PT0gXCJoaWRlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGJsYW5rLmhpZGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlmX251bGwgPT09IFwicmVtb3ZlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGJsYW5rLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJGJsYW5rXHJcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJmaWxsXCIpXHJcbiAgICAgICAgICAgICAgICAucmVtb3ZlQXR0cihcImRhdGEtZmlsbFwiKVxyXG4gICAgICAgICAgICAgICAgLnJlbW92ZUF0dHIoXCJkYXRhLWZpbGwtbnVsbFwiKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAoJHJlbmRlci5oYXNDbGFzcyhcImZpbGxcIikpIHtcclxuICAgICAgICAgICAgJHJlbmRlci5maWxsQmxhbmtzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkKFwiLmZpbGxcIiwgJHJlbmRlcikuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICQodGhpcykuZmlsbEJsYW5rcygpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gJHJlbmRlcjtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHJlbmRlclxyXG4gICAgfTtcclxufSkoKTtcclxuXHJcbmxldCBfX3JlbmRlciA9IHVpLnRlbXBsYXRlLnJlbmRlcjtcclxuIiwiLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4vLyBwbGF5ZXIgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcbmxldCAkcGxheWVyO1xyXG5cclxubGV0ICRucCA9IHsgfTtcclxuXHJcbiQoZnVuY3Rpb24oKSB7XHJcbiAgICAkcGxheWVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImF1ZGlvLnBsYXllclwiKTtcclxuXHJcbiAgICAkbnAucG9zaXRpb24gPSAkKFwiLm5vdy1wbGF5aW5nIC5wb3NpdGlvblwiKTtcclxuICAgICRucC5sZW5ndGggPSAkKFwiLm5vdy1wbGF5aW5nIC5sZW5ndGhcIik7XHJcbiAgICAkbnAudGltZWxpbmUgPSAkKFwiLm5vdy1wbGF5aW5nIC5iYXJcIik7XHJcbiAgICAkbnAuZWxhcHNlZCA9ICQoXCIubm93LXBsYXlpbmcgLmVsYXBzZWRcIik7XHJcblxyXG4gICAgJHBsYXllci5hZGRFdmVudExpc3RlbmVyKFwidGltZXVwZGF0ZVwiLCAoZXZlbnQpID0+IHtcclxuICAgICAgICBsZXQgbGVuZ3RoID0gZHVyYXRpb24oJHBsYXllci5kdXJhdGlvbik7XHJcbiAgICAgICAgJG5wLmxlbmd0aC50ZXh0KGxlbmd0aCk7XHJcblxyXG4gICAgICAgIGxldCBwb3NpdGlvbiA9IGR1cmF0aW9uKCRwbGF5ZXIuY3VycmVudFRpbWUpO1xyXG4gICAgICAgICRucC5wb3NpdGlvbi50ZXh0KHBvc2l0aW9uKTtcclxuXHJcbiAgICAgICAgbGV0IHBlcmNlbnQgPSAkcGxheWVyLmN1cnJlbnRUaW1lIC8gJHBsYXllci5kdXJhdGlvbiAqIDEwMDtcclxuICAgICAgICAkbnAuZWxhcHNlZC5jc3MoXCJ3aWR0aFwiLCBwZXJjZW50ICsgXCIlXCIpO1xyXG5cclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhwb3NpdGlvbl9pc19zZWNvbmRzLCBodW1hbl9wb3NpdGlvbik7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkdWlbXCJub3ctcGxheWluZ1wiXSA9ICQoXCIubm93LXBsYXlpbmdcIik7XHJcbiAgICAkKFwiLnBsYXlcIiwgJHVpW1wibm93LXBsYXlpbmdcIl0pLm9uKFwiY2xpY2tcIiwgYXBwLlBsYXllci5wbGF5UGF1c2UpO1xyXG5cclxuICAgIC8vIENsaXF1ZXMgbmEgbGluaGEgZG8gdGVtcG9cclxuICAgICRucC50aW1lbGluZS5vbihcImNsaWNrXCIsIChldmVudCkgPT4ge1xyXG4gICAgICAgIGxldCB3aWR0aCA9ICQoZXZlbnQuZGVsZWdhdGVUYXJnZXQpLndpZHRoKCk7XHJcbiAgICAgICAgbGV0IHBvc2l0aW9uID0gZXZlbnQub2Zmc2V0WDtcclxuICAgICAgICBsZXQgcGVyY2VudCA9IHBvc2l0aW9uIC8gd2lkdGg7XHJcblxyXG4gICAgICAgIGxldCBwb3NpdGlvbl9pbl9zZWNvbmRzID0gJHBsYXllci5kdXJhdGlvbiAqIHBlcmNlbnQ7XHJcbiAgICAgICAgYXBwLlBsYXllci5za2lwVG9Qb3NpdGlvbihwb3NpdGlvbl9pbl9zZWNvbmRzKTtcclxuICAgIH0pO1xyXG59KTtcclxuXHJcbmFwcC5QbGF5ZXIgPSAoKCkgPT4ge1xyXG5cclxuICAgIC8vIGNvbnN0IHVwZGF0ZVRpbWVsaW5lXHJcblxyXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbiAgICAvLyBhcHAuUGxheWVyLnNraXBUb1Bvc2l0aW9uKClcclxuICAgIGNvbnN0IHNraXBUb1Bvc2l0aW9uID0gKHNlY29uZHMpID0+IHtcclxuICAgICAgICAkcGxheWVyLmN1cnJlbnRUaW1lID0gc2Vjb25kcztcclxuICAgIH07XHJcblxyXG5cclxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4gICAgLy8gYXBwLlBsYXllci5wbGF5KClcclxuICAgIGNvbnN0IHBsYXkgPSAoKSA9PiB7XHJcbiAgICAgICAgJHBsYXllci5wbGF5KCk7XHJcbiAgICB9O1xyXG5cclxuXHJcbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuICAgIC8vIGFwcC5QbGF5ZXIucGF1c2UoKVxyXG4gICAgY29uc3QgcGF1c2UgPSAoKSA9PiB7XHJcbiAgICAgICAgJHBsYXllci5wYXVzZSgpO1xyXG4gICAgfTtcclxuXHJcblxyXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbiAgICAvLyBhcHAuUGxheWVyLnBsYXlQYXVzZSgpXHJcbiAgICBjb25zdCBwbGF5UGF1c2UgPSAoKSA9PiB7XHJcbiAgICAgICAgaWYgKCRwbGF5ZXIucGF1c2VkKSB7XHJcbiAgICAgICAgICAgICRwbGF5ZXIucGxheSgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICRwbGF5ZXIucGF1c2UoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiZHVyYXRpb25cIiwgJHBsYXllci5kdXJhdGlvbik7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJ2b2x1bWVcIiwgJHBsYXllci52b2x1bWUpO1xyXG5cclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcImJ1ZmZlcmVkXCIsICRwbGF5ZXIuYnVmZmVyZWQpO1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwibmV0d29ya1N0YXRlXCIsICRwbGF5ZXIubmV0d29ya1N0YXRlKTtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcInBsYXllZFwiLCAkcGxheWVyLnBsYXllZCk7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJyZWFkeVN0YXRlXCIsICRwbGF5ZXIucmVhZHlTdGF0ZSk7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJzZWVrYWJsZVwiLCAkcGxheWVyLnNlZWthYmxlKTtcclxuICAgIH07XHJcblxyXG5cclxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgc2tpcFRvUG9zaXRpb24sXHJcbiAgICAgICAgcGxheSxcclxuICAgICAgICBwYXVzZSxcclxuICAgICAgICBwbGF5UGF1c2VcclxuICAgIH07XHJcbn0pKCk7XHJcbiIsIi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuLy8gYXJ0aXN0IC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5hcHAuQXJ0aXN0ID0gKCgpID0+IHtcclxuXHJcbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuICAgIC8vIGFwcC5BcnRpc3QubG9hZCgpXHJcbiAgICBjb25zdCBsb2FkID0gKGFydGlzdF9pZCkgPT4ge1xyXG4gICAgICAgICQuZ2V0KFwiZGF0YS9hcnRpc3RzL1wiICsgYXJ0aXN0X2lkICsgXCIuanNvblwiKS5kb25lKChyZXNwb25zZSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgYXJ0aXN0ID0gcmVzcG9uc2U7XHJcbiAgICAgICAgICAgIGxldCAkYXJ0aXN0ID0gX19yZW5kZXIoXCJhcnRpc3RcIiwgYXJ0aXN0KTtcclxuXHJcbiAgICAgICAgICAgIC8vIMOBbGJ1bnNcclxuICAgICAgICAgICAgbGV0IGFsYnVtcyA9IGFydGlzdFtcImFsYnVtc1wiXTtcclxuICAgICAgICAgICAgbGV0ICRhbGJ1bXMgPSAkKFwiLmFsYnVtc1wiLCAkYXJ0aXN0KTtcclxuXHJcbiAgICAgICAgICAgIGFsYnVtcy5mb3JFYWNoKChhbGJ1bSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgYWxidW1bXCJjb3Zlci1hcnRcIl0gPSBcImJhY2tncm91bmQtaW1hZ2U6IHVybCgnXCIgKyBhbGJ1bVtcImNvdmVyXCJdICsgXCInKVwiO1xyXG4gICAgICAgICAgICAgICAgbGV0ICRhbGJ1bSA9IF9fcmVuZGVyKFwiYXJ0aXN0LWFsYnVtXCIsIGFsYnVtKS5hcHBlbmRUbygkYWxidW1zKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBIaXRzXHJcbiAgICAgICAgICAgIGxldCBoaXRzID0gYXJ0aXN0W1wiaGl0c1wiXTtcclxuICAgICAgICAgICAgbGV0ICRoaXRzID0gJChcIi5oaXRzXCIsICRhcnRpc3QpO1xyXG5cclxuICAgICAgICAgICAgaGl0cy5mb3JFYWNoKChoaXQpID0+IHtcclxuICAgICAgICAgICAgICAgIGhpdFtcImZvcm1hdHRlZC1sZW5ndGhcIl0gPSBkdXJhdGlvbihoaXRbXCJsZW5ndGhcIl0pO1xyXG4gICAgICAgICAgICAgICAgbGV0ICRoaXQgPSBfX3JlbmRlcihcImFydGlzdC1oaXRcIiwgaGl0KS5hcHBlbmRUbygkaGl0cyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gQ29sb2NhIG5hIHRlbGFcclxuICAgICAgICAgICAgJHVpW1wibGlicmFyeVwiXS5lbXB0eSgpLmFwcGVuZCgkYXJ0aXN0KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG5cclxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgbG9hZFxyXG4gICAgfTtcclxufSkoKTtcclxuIiwiLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4vLyBzdGFydCAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcbiQoZnVuY3Rpb24oKSB7XHJcbiAgICBhcHAuQXJ0aXN0LmxvYWQoXCJ0aGUtYmVhdGxlc1wiKTtcclxufSk7XHJcbiJdfQ==
