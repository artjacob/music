"use strict";

////////////////////////////////////////////////////////////////////////////////////////////////////
// base ////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////
var app = {};
var ui = {};
var $ui = {};
var cue = {}; // TODO: mover para lugar apropriado

$(function () {
  $ui["library"] = $(".library");
});

var duration = function duration(seconds) {
  return moment.utc(moment.duration(seconds, "seconds").asMilliseconds()).format("m:ss");
}; ////////////////////////////////////////////////////////////////////////////////////////////////////
// core / template engine //////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////


ui.template = function () {
  var $templates = {};
  $(function () {
    $("template").each(function () {
      var $this = $(this);
      var name = $this.attr("id");
      var html = $this.html();
      $templates[name] = $(html);
      $this.remove();
    });
  });

  var render = function render(template, data) {
    if (!$templates[template]) {
      return false;
    }

    var $render = $templates[template].clone();
    $render.data(data);

    $.fn.fillBlanks = function () {
      var $blank = $(this);
      var fill = $blank.data("fill");
      var rules = fill.split(",");

      for (var i = 0; i < rules.length; i++) {
        var pair = rules[i].split(":");
        var dest = pair[1] ? pair[0].trim() : "html";
        var source = pair[1] ? pair[1].trim() : pair[0];
        var value = data[source];
        source = source.split("/");

        if (source.length > 1 && typeof value !== "undefined") {
          value = data[source[0]];

          for (var j = 1; j < source.length; j++) {
            value = value[source[j]] ? value[source[j]] : null;
          }
        }

        if (typeof value !== "undefined" && value !== null) {
          if (dest === "class") {
            $blank.addClass(value);
          } else if (dest === "html") {
            $blank.html(value);
          } else if (dest === "value") {
            $blank.val(value);
          } else {
            $blank.attr(dest, value);
          }
        } else {
          var if_null = $blank.data("fill-null");

          if (if_null === "hide") {
            $blank.hide();
          } else if (if_null === "remove") {
            $blank.remove();
          }
        }
      }

      $blank.removeClass("fill").removeAttr("data-fill").removeAttr("data-fill-null");
    };

    if ($render.hasClass("fill")) {
      $render.fillBlanks();
    }

    $(".fill", $render).each(function () {
      $(this).fillBlanks();
    });
    return $render;
  };

  return {
    render: render
  };
}();

var __render = ui.template.render; ////////////////////////////////////////////////////////////////////////////////////////////////////
// player //////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

var queue = [{
  "title": "Captain Calvin (Original Mix)",
  "artist": "Louk",
  "album": "Chillhop Essentials Winter 2018",
  "length": 140,
  "cover": "https://lh3.googleusercontent.com/JJAK0mX_p5KLf9_efSEr7l2o2oAGyCn7b8-pOsfp8_jf02uvJUIJ1pDtDZx1JsJAfM5YOe2BIEA",
  "file": "/data/files/14 Captain Calvin (Original Mix).mp3"
}, {
  "title": "Tico Tico",
  "artist": "Oscar Peterson",
  "album": "Ultimate Jazz Collections",
  "length": 180,
  "cover": "https://lh5.ggpht.com/hwEKMItKyFyHIgNl28CfbBr-RYLvNhDUj_SFe757m_gH2yNsoRXYmXgWI02tkAoVLKCNIihb",
  "file": "/data/files/30 Tico Tico.m4a"
}];
var $np;

app.Player = function () {
  var $player = document.createElement("audio");
  var queue_position = 0;
  $(function () {
    $np = $(".now-playing");
    $np.position = $(".now-playing .position");
    $np.length = $(".now-playing .length");
    $np.timeline = $(".now-playing .bar");
    $np.elapsed = $(".now-playing .elapsed");
    $np.song = $(".now-playing .song");
    $np.artist = $(".now-playing .artist");
    $np.album = $(".now-playing .album");
    $np.cover = $(".now-playing .cover");
    $player.addEventListener("timeupdate", function (event) {
      var position = duration($player.currentTime);
      $np.position.text(position);
      var percent = $player.currentTime / $player.duration * 100;
      $np.elapsed.css("width", percent + "%"); // console.log(position_is_seconds, human_position);
    }); // Define o tempo de duração quando uma música é carregada música

    $player.addEventListener("loadedmetadata", function () {
      var length = duration($player.duration);
      $np.length.text(length);
    });
    $ui["now-playing"] = $(".now-playing");
    $(".play-pause", $ui["now-playing"]).on("click", app.Player.playPause);
    $(".skip-prev", $ui["now-playing"]).on("click", app.Player.previousTrack);
    $(".skip-next", $ui["now-playing"]).on("click", app.Player.nextTrack); // Cliques na linha do tempo

    $np.timeline.on("click", function (event) {
      var width = $(event.delegateTarget).width();
      var position = event.offsetX;
      var percent = position / width;
      var position_in_seconds = $player.duration * percent;
      app.Player.skipToPosition(position_in_seconds);
    }); // Carrega a primeira música da fila

    app.Player.load(queue[queue_position]);
  }); // const updateTimeline
  ////////////////////////////////////////////////////////////////////////////////////////////////
  // app.Player.skipToPosition()

  var load = function load(song) {
    // Pausa a reprodução, reseta o tempo e carrega a nova música
    app.Player.pause();
    $player.currentTime = 0;
    $player.src = song["file"]; // Atualiza as informações sobre a música em reprodução

    $np.song.text(song["title"]);
    $np.artist.text(song["artist"]);
    $np.album.text(song["album"]);
    $np.cover.css("background-image", "url('" + song["cover"] + "')"); // Atualiza dados da Media Session API

    if ("mediaSession" in navigator) {
      navigator.mediaSession.metadata = new MediaMetadata({
        "title": song["title"],
        "artist": song["artist"],
        "album": song["album"],
        "artwork": [{
          "src": song["cover"],
          "sizes": "512x512",
          "type": "image/png"
        }]
      });
    } // Inicia a reprodução


    app.Player.play();
  }; ////////////////////////////////////////////////////////////////////////////////////////////////
  // app.Player.skipToPosition()


  var skipToPosition = function skipToPosition(seconds) {
    $player.currentTime = seconds;
  }; ////////////////////////////////////////////////////////////////////////////////////////////////
  // app.Player.play()


  var play = function play() {
    $player.play();
    $np.removeClass("-state--paused").addClass("-state--playing");
  }; ////////////////////////////////////////////////////////////////////////////////////////////////
  // app.Player.pause()


  var pause = function pause() {
    $player.pause();
    $np.removeClass("-state--playing").addClass("-state--paused");
  }; ////////////////////////////////////////////////////////////////////////////////////////////////
  // app.Player.playPause()


  var playPause = function playPause() {
    if ($player.paused) {
      app.Player.play();
    } else {
      app.Player.pause();
    } // console.log("duration", $player.duration);
    // console.log("volume", $player.volume);
    // console.log("buffered", $player.buffered);
    // console.log("networkState", $player.networkState);
    // console.log("played", $player.played);
    // console.log("readyState", $player.readyState);
    // console.log("seekable", $player.seekable);

  }; ////////////////////////////////////////////////////////////////////////////////////////////////
  // app.Player.previousTrack()


  var previousTrack = function previousTrack() {
    queue_position = (queue_position - 1 + queue.length) % queue.length;
    app.Player.load(queue[queue_position]);
  }; ////////////////////////////////////////////////////////////////////////////////////////////////
  // app.Player.nextTrack()


  var nextTrack = function nextTrack() {
    queue_position = (queue_position + 1) % queue.length;
    app.Player.load(queue[queue_position]);
  }; ////////////////////////////////////////////////////////////////////////////////////////////////


  return {
    load: load,
    skipToPosition: skipToPosition,
    play: play,
    pause: pause,
    playPause: playPause,
    previousTrack: previousTrack,
    nextTrack: nextTrack
  };
}();

if ("mediaSession" in navigator) {
  navigator.mediaSession.setActionHandler("play", app.Player.play);
  navigator.mediaSession.setActionHandler("pause", app.Player.pause); // navigator.mediaSession.setActionHandler("seekbackward", function () { });
  // navigator.mediaSession.setActionHandler("seekforward", function () { });

  navigator.mediaSession.setActionHandler("previoustrack", app.Player.previousTrack);
  navigator.mediaSession.setActionHandler("nexttrack", app.Player.nextTrack);
} ////////////////////////////////////////////////////////////////////////////////////////////////////
// artist //////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////


app.Artist = function () {
  ////////////////////////////////////////////////////////////////////////////////////////////////
  // app.Artist.load()
  var load = function load(artist_id) {
    $.get("data/artists/" + artist_id + ".json").done(function (response) {
      var artist = response;

      var $artist = __render("artist", artist); // Álbuns


      var albums = artist["albums"];
      var $albums = $(".albums", $artist);
      albums.forEach(function (album) {
        album["cover-art"] = "background-image: url('" + album["cover"] + "')";

        var $album = __render("artist-album", album).appendTo($albums);
      }); // Hits

      var hits = artist["hits"];
      var $hits = $(".hits", $artist);
      hits.forEach(function (hit) {
        hit["formatted-length"] = duration(hit["length"]);

        var $hit = __render("artist-hit", hit).appendTo($hits);
      }); // Coloca na tela

      $ui["library"].empty().append($artist);
    });
  }; ////////////////////////////////////////////////////////////////////////////////////////////////


  return {
    load: load
  };
}(); ////////////////////////////////////////////////////////////////////////////////////////////////////
// start ///////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////


$(function () {
  app.Artist.load("the-beatles");
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJhc2UuanMiLCJ0ZW1wbGF0ZS1lbmdpbmUuanMiLCJwbGF5ZXIuanMiLCJhcnRpc3QuanMiLCJzdGFydC5qcyJdLCJuYW1lcyI6WyJhcHAiLCJ1aSIsIiR1aSIsImN1ZSIsIiQiLCJkdXJhdGlvbiIsInNlY29uZHMiLCJtb21lbnQiLCJ1dGMiLCJhc01pbGxpc2Vjb25kcyIsImZvcm1hdCIsInRlbXBsYXRlIiwiJHRlbXBsYXRlcyIsImVhY2giLCIkdGhpcyIsIm5hbWUiLCJhdHRyIiwiaHRtbCIsInJlbW92ZSIsInJlbmRlciIsImRhdGEiLCIkcmVuZGVyIiwiY2xvbmUiLCJmbiIsImZpbGxCbGFua3MiLCIkYmxhbmsiLCJmaWxsIiwicnVsZXMiLCJzcGxpdCIsImkiLCJsZW5ndGgiLCJwYWlyIiwiZGVzdCIsInRyaW0iLCJzb3VyY2UiLCJ2YWx1ZSIsImoiLCJhZGRDbGFzcyIsInZhbCIsImlmX251bGwiLCJoaWRlIiwicmVtb3ZlQ2xhc3MiLCJyZW1vdmVBdHRyIiwiaGFzQ2xhc3MiLCJfX3JlbmRlciIsInF1ZXVlIiwiJG5wIiwiUGxheWVyIiwiJHBsYXllciIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInF1ZXVlX3Bvc2l0aW9uIiwicG9zaXRpb24iLCJ0aW1lbGluZSIsImVsYXBzZWQiLCJzb25nIiwiYXJ0aXN0IiwiYWxidW0iLCJjb3ZlciIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsImN1cnJlbnRUaW1lIiwidGV4dCIsInBlcmNlbnQiLCJjc3MiLCJvbiIsInBsYXlQYXVzZSIsInByZXZpb3VzVHJhY2siLCJuZXh0VHJhY2siLCJ3aWR0aCIsImRlbGVnYXRlVGFyZ2V0Iiwib2Zmc2V0WCIsInBvc2l0aW9uX2luX3NlY29uZHMiLCJza2lwVG9Qb3NpdGlvbiIsImxvYWQiLCJwYXVzZSIsInNyYyIsIm5hdmlnYXRvciIsIm1lZGlhU2Vzc2lvbiIsIm1ldGFkYXRhIiwiTWVkaWFNZXRhZGF0YSIsInBsYXkiLCJwYXVzZWQiLCJzZXRBY3Rpb25IYW5kbGVyIiwiQXJ0aXN0IiwiYXJ0aXN0X2lkIiwiZ2V0IiwiZG9uZSIsInJlc3BvbnNlIiwiJGFydGlzdCIsImFsYnVtcyIsIiRhbGJ1bXMiLCJmb3JFYWNoIiwiJGFsYnVtIiwiYXBwZW5kVG8iLCJoaXRzIiwiJGhpdHMiLCJoaXQiLCIkaGl0IiwiZW1wdHkiLCJhcHBlbmQiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBRUEsSUFBQUEsR0FBQSxHQUFBLEVBQUE7QUFFQSxJQUFBQyxFQUFBLEdBQUEsRUFBQTtBQUNBLElBQUFDLEdBQUEsR0FBQSxFQUFBO0FBRUEsSUFBQUMsR0FBQSxHQUFBLEVBQUEsQyxDQUtBOztBQUNBQyxDQUFBLENBQUEsWUFBQTtBQUNBRixFQUFBQSxHQUFBLENBQUEsU0FBQSxDQUFBLEdBQUFFLENBQUEsQ0FBQSxVQUFBLENBQUE7QUFDQSxDQUZBLENBQUE7O0FBSUEsSUFBQUMsUUFBQSxHQUFBLFNBQUFBLFFBQUEsQ0FBQUMsT0FBQSxFQUFBO0FBQ0EsU0FBQUMsTUFBQSxDQUFBQyxHQUFBLENBQUFELE1BQUEsQ0FBQUYsUUFBQSxDQUFBQyxPQUFBLEVBQUEsU0FBQSxFQUFBRyxjQUFBLEVBQUEsRUFBQUMsTUFBQSxDQUFBLE1BQUEsQ0FBQTtBQUNBLENBRkEsQyxDQ25CQTtBQUNBO0FBQ0E7OztBQUVBVCxFQUFBLENBQUFVLFFBQUEsR0FBQSxZQUFBO0FBQ0EsTUFBQUMsVUFBQSxHQUFBLEVBQUE7QUFFQVIsRUFBQUEsQ0FBQSxDQUFBLFlBQUE7QUFDQUEsSUFBQUEsQ0FBQSxDQUFBLFVBQUEsQ0FBQSxDQUFBUyxJQUFBLENBQUEsWUFBQTtBQUNBLFVBQUFDLEtBQUEsR0FBQVYsQ0FBQSxDQUFBLElBQUEsQ0FBQTtBQUNBLFVBQUFXLElBQUEsR0FBQUQsS0FBQSxDQUFBRSxJQUFBLENBQUEsSUFBQSxDQUFBO0FBQ0EsVUFBQUMsSUFBQSxHQUFBSCxLQUFBLENBQUFHLElBQUEsRUFBQTtBQUVBTCxNQUFBQSxVQUFBLENBQUFHLElBQUEsQ0FBQSxH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QUFBLFlBQUEsRUFBQXFELEdBQUEsQ0FBQSxDQUFBSCxRQUFBLENBQUFFLEtBQUEsQ0FBQTtBQUNBLE9BSEEsRUFqQkEsQ0FzQkE7O0FBQ0E5RixNQUFBQSxHQUFBLENBQUEsU0FBQSxDQUFBLENBQUFpRyxLQUFBLEdBQUFDLE1BQUEsQ0FBQVgsT0FBQTtBQUNBLEtBeEJBO0FBeUJBLEdBMUJBLENBSkEsQ0FpQ0E7OztBQUVBLFNBQUE7QUFDQWYsSUFBQUEsSUFBQSxFQUFBQTtBQURBLEdBQUE7QUFHQSxDQXRDQSxFQUFBLEMsQ0NKQTtBQUNBO0FBQ0E7OztBQUVBdEUsQ0FBQSxDQUFBLFlBQUE7QUFDQUosRUFBQUEsR0FBQSxDQUFBb0YsTUFBQSxDQUFBVixJQUFBLENBQUEsYUFBQTtBQUNBLENBRkEsQ0FBQSIsImZpbGUiOiJtdXNpYy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuLy8gYmFzZSAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5sZXQgYXBwID0geyB9O1xyXG5cclxubGV0IHVpID0geyB9O1xyXG5sZXQgJHVpID0geyB9O1xyXG5cclxubGV0IGN1ZSA9IHsgfTtcclxuXHJcblxyXG5cclxuXHJcbi8vIFRPRE86IG1vdmVyIHBhcmEgbHVnYXIgYXByb3ByaWFkb1xyXG4kKGZ1bmN0aW9uKCkge1xyXG4gICAgJHVpW1wibGlicmFyeVwiXSA9ICQoXCIubGlicmFyeVwiKTtcclxufSk7XHJcblxyXG5jb25zdCBkdXJhdGlvbiA9IChzZWNvbmRzKSA9PiB7XHJcbiAgICByZXR1cm4gbW9tZW50LnV0Yyhtb21lbnQuZHVyYXRpb24oc2Vjb25kcywgXCJzZWNvbmRzXCIpLmFzTWlsbGlzZWNvbmRzKCkpLmZvcm1hdChcIm06c3NcIik7XHJcbn07XHJcbiIsIi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuLy8gY29yZSAvIHRlbXBsYXRlIGVuZ2luZSAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG51aS50ZW1wbGF0ZSA9ICgoKSA9PiB7XHJcbiAgICBsZXQgJHRlbXBsYXRlcyA9IHsgfTtcclxuXHJcbiAgICAkKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkKFwidGVtcGxhdGVcIikuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XHJcbiAgICAgICAgICAgIHZhciBuYW1lID0gJHRoaXMuYXR0cihcImlkXCIpO1xyXG4gICAgICAgICAgICB2YXIgaHRtbCA9ICR0aGlzLmh0bWwoKTtcclxuXHJcbiAgICAgICAgICAgICR0ZW1wbGF0ZXNbbmFtZV0gPSAkKGh0bWwpO1xyXG4gICAgICAgICAgICAkdGhpcy5yZW1vdmUoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IHJlbmRlciA9ICh0ZW1wbGF0ZSwgZGF0YSkgPT4ge1xyXG4gICAgICAgIGlmICghJHRlbXBsYXRlc1t0ZW1wbGF0ZV0pIHsgcmV0dXJuIGZhbHNlOyB9XHJcbiAgICAgICAgdmFyICRyZW5kZXIgPSAkdGVtcGxhdGVzW3RlbXBsYXRlXS5jbG9uZSgpO1xyXG5cclxuICAgICAgICAkcmVuZGVyLmRhdGEoZGF0YSk7XHJcblxyXG4gICAgICAgICQuZm4uZmlsbEJsYW5rcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyICRibGFuayA9ICQodGhpcyk7XHJcbiAgICAgICAgICAgIHZhciBmaWxsID0gJGJsYW5rLmRhdGEoXCJmaWxsXCIpO1xyXG5cclxuICAgICAgICAgICAgdmFyIHJ1bGVzID0gZmlsbC5zcGxpdChcIixcIik7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcnVsZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBwYWlyID0gcnVsZXNbaV0uc3BsaXQoXCI6XCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlc3QgPSAocGFpclsxXSA/IHBhaXJbMF0udHJpbSgpIDogXCJodG1sXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHNvdXJjZSA9IChwYWlyWzFdID8gcGFpclsxXS50cmltKCkgOiBwYWlyWzBdKTtcclxuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGRhdGFbc291cmNlXTtcclxuXHJcbiAgICAgICAgICAgICAgICBzb3VyY2UgPSBzb3VyY2Uuc3BsaXQoXCIvXCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNvdXJjZS5sZW5ndGggPiAxICYmIHR5cGVvZiB2YWx1ZSAhPT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gZGF0YVtzb3VyY2VbMF1dO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMTsgaiA8IHNvdXJjZS5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9ICh2YWx1ZVtzb3VyY2Vbal1dKSA/IHZhbHVlW3NvdXJjZVtqXV0gOiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSBcInVuZGVmaW5lZFwiICYmIHZhbHVlICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRlc3QgPT09IFwiY2xhc3NcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkYmxhbmsuYWRkQ2xhc3ModmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGVzdCA9PT0gXCJodG1sXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGJsYW5rLmh0bWwodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGVzdCA9PT0gXCJ2YWx1ZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRibGFuay52YWwodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRibGFuay5hdHRyKGRlc3QsIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZl9udWxsID0gJGJsYW5rLmRhdGEoXCJmaWxsLW51bGxcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlmX251bGwgPT09IFwiaGlkZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRibGFuay5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpZl9udWxsID09PSBcInJlbW92ZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRibGFuay5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRibGFua1xyXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiZmlsbFwiKVxyXG4gICAgICAgICAgICAgICAgLnJlbW92ZUF0dHIoXCJkYXRhLWZpbGxcIilcclxuICAgICAgICAgICAgICAgIC5yZW1vdmVBdHRyKFwiZGF0YS1maWxsLW51bGxcIik7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaWYgKCRyZW5kZXIuaGFzQ2xhc3MoXCJmaWxsXCIpKSB7XHJcbiAgICAgICAgICAgICRyZW5kZXIuZmlsbEJsYW5rcygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJChcIi5maWxsXCIsICRyZW5kZXIpLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkKHRoaXMpLmZpbGxCbGFua3MoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuICRyZW5kZXI7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICByZW5kZXJcclxuICAgIH07XHJcbn0pKCk7XHJcblxyXG5sZXQgX19yZW5kZXIgPSB1aS50ZW1wbGF0ZS5yZW5kZXI7XHJcbiIsIi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuLy8gcGxheWVyIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5sZXQgcXVldWUgPSBbXHJcbiAgICB7XHJcbiAgICAgICAgXCJ0aXRsZVwiOiBcIkNhcHRhaW4gQ2FsdmluIChPcmlnaW5hbCBNaXgpXCIsXHJcbiAgICAgICAgXCJhcnRpc3RcIjogXCJMb3VrXCIsXHJcbiAgICAgICAgXCJhbGJ1bVwiOiBcIkNoaWxsaG9wIEVzc2VudGlhbHMgV2ludGVyIDIwMThcIixcclxuICAgICAgICBcImxlbmd0aFwiOiAxNDAsXHJcbiAgICAgICAgXCJjb3ZlclwiOiBcImh0dHBzOi8vbGgzLmdvb2dsZXVzZXJjb250ZW50LmNvbS9KSkFLMG1YX3A1S0xmOV9lZlNFcjdsMm8yb0FHeUNuN2I4LXBPc2ZwOF9qZjAydXZKVUlKMXBEdERaeDFKc0pBZk01WU9lMkJJRUFcIixcclxuICAgICAgICBcImZpbGVcIjogXCIvZGF0YS9maWxlcy8xNCBDYXB0YWluIENhbHZpbiAoT3JpZ2luYWwgTWl4KS5tcDNcIlxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgICBcInRpdGxlXCI6IFwiVGljbyBUaWNvXCIsXHJcbiAgICAgICAgXCJhcnRpc3RcIjogXCJPc2NhciBQZXRlcnNvblwiLFxyXG4gICAgICAgIFwiYWxidW1cIjogXCJVbHRpbWF0ZSBKYXp6IENvbGxlY3Rpb25zXCIsXHJcbiAgICAgICAgXCJsZW5ndGhcIjogMTgwLFxyXG4gICAgICAgIFwiY292ZXJcIjogXCJodHRwczovL2xoNS5nZ3BodC5jb20vaHdFS01JdEt5RnlISWdObDI4Q2ZiQnItUllMdk5oRFVqX1NGZTc1N21fZ0gyeU5zb1JYWW1YZ1dJMDJ0a0FvVkxLQ05JaWhiXCIsXHJcbiAgICAgICAgXCJmaWxlXCI6IFwiL2RhdGEvZmlsZXMvMzAgVGljbyBUaWNvLm00YVwiXHJcbiAgICB9XHJcbl07XHJcblxyXG5sZXQgJG5wO1xyXG5cclxuYXBwLlBsYXllciA9ICgoKSA9PiB7XHJcbiAgICBsZXQgJHBsYXllciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhdWRpb1wiKTtcclxuICAgIGxldCBxdWV1ZV9wb3NpdGlvbiA9IDA7XHJcblxyXG4gICAgJChmdW5jdGlvbigpIHtcclxuICAgICAgICAkbnAgPSAkKFwiLm5vdy1wbGF5aW5nXCIpO1xyXG4gICAgICAgICRucC5wb3NpdGlvbiA9ICQoXCIubm93LXBsYXlpbmcgLnBvc2l0aW9uXCIpO1xyXG4gICAgICAgICRucC5sZW5ndGggPSAkKFwiLm5vdy1wbGF5aW5nIC5sZW5ndGhcIik7XHJcbiAgICAgICAgJG5wLnRpbWVsaW5lID0gJChcIi5ub3ctcGxheWluZyAuYmFyXCIpO1xyXG4gICAgICAgICRucC5lbGFwc2VkID0gJChcIi5ub3ctcGxheWluZyAuZWxhcHNlZFwiKTtcclxuXHJcbiAgICAgICAgJG5wLnNvbmcgPSAkKFwiLm5vdy1wbGF5aW5nIC5zb25nXCIpO1xyXG4gICAgICAgICRucC5hcnRpc3QgPSAkKFwiLm5vdy1wbGF5aW5nIC5hcnRpc3RcIik7XHJcbiAgICAgICAgJG5wLmFsYnVtID0gJChcIi5ub3ctcGxheWluZyAuYWxidW1cIik7XHJcbiAgICAgICAgJG5wLmNvdmVyID0gJChcIi5ub3ctcGxheWluZyAuY292ZXJcIik7XHJcblxyXG4gICAgICAgICRwbGF5ZXIuYWRkRXZlbnRMaXN0ZW5lcihcInRpbWV1cGRhdGVcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBwb3NpdGlvbiA9IGR1cmF0aW9uKCRwbGF5ZXIuY3VycmVudFRpbWUpO1xyXG4gICAgICAgICAgICAkbnAucG9zaXRpb24udGV4dChwb3NpdGlvbik7XHJcblxyXG4gICAgICAgICAgICBsZXQgcGVyY2VudCA9ICRwbGF5ZXIuY3VycmVudFRpbWUgLyAkcGxheWVyLmR1cmF0aW9uICogMTAwO1xyXG4gICAgICAgICAgICAkbnAuZWxhcHNlZC5jc3MoXCJ3aWR0aFwiLCBwZXJjZW50ICsgXCIlXCIpO1xyXG5cclxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocG9zaXRpb25faXNfc2Vjb25kcywgaHVtYW5fcG9zaXRpb24pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBEZWZpbmUgbyB0ZW1wbyBkZSBkdXJhw6fDo28gcXVhbmRvIHVtYSBtw7pzaWNhIMOpIGNhcnJlZ2FkYSBtw7pzaWNhXHJcbiAgICAgICAgJHBsYXllci5hZGRFdmVudExpc3RlbmVyKFwibG9hZGVkbWV0YWRhdGFcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgbGVuZ3RoID0gZHVyYXRpb24oJHBsYXllci5kdXJhdGlvbik7XHJcbiAgICAgICAgICAgICRucC5sZW5ndGgudGV4dChsZW5ndGgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkdWlbXCJub3ctcGxheWluZ1wiXSA9ICQoXCIubm93LXBsYXlpbmdcIik7XHJcbiAgICAgICAgJChcIi5wbGF5LXBhdXNlXCIsICR1aVtcIm5vdy1wbGF5aW5nXCJdKS5vbihcImNsaWNrXCIsIGFwcC5QbGF5ZXIucGxheVBhdXNlKTtcclxuICAgICAgICAkKFwiLnNraXAtcHJldlwiLCAkdWlbXCJub3ctcGxheWluZ1wiXSkub24oXCJjbGlja1wiLCBhcHAuUGxheWVyLnByZXZpb3VzVHJhY2spO1xyXG4gICAgICAgICQoXCIuc2tpcC1uZXh0XCIsICR1aVtcIm5vdy1wbGF5aW5nXCJdKS5vbihcImNsaWNrXCIsIGFwcC5QbGF5ZXIubmV4dFRyYWNrKTtcclxuXHJcbiAgICAgICAgLy8gQ2xpcXVlcyBuYSBsaW5oYSBkbyB0ZW1wb1xyXG4gICAgICAgICRucC50aW1lbGluZS5vbihcImNsaWNrXCIsIChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgd2lkdGggPSAkKGV2ZW50LmRlbGVnYXRlVGFyZ2V0KS53aWR0aCgpO1xyXG4gICAgICAgICAgICBsZXQgcG9zaXRpb24gPSBldmVudC5vZmZzZXRYO1xyXG4gICAgICAgICAgICBsZXQgcGVyY2VudCA9IHBvc2l0aW9uIC8gd2lkdGg7XHJcblxyXG4gICAgICAgICAgICBsZXQgcG9zaXRpb25faW5fc2Vjb25kcyA9ICRwbGF5ZXIuZHVyYXRpb24gKiBwZXJjZW50O1xyXG4gICAgICAgICAgICBhcHAuUGxheWVyLnNraXBUb1Bvc2l0aW9uKHBvc2l0aW9uX2luX3NlY29uZHMpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBDYXJyZWdhIGEgcHJpbWVpcmEgbcO6c2ljYSBkYSBmaWxhXHJcbiAgICAgICAgYXBwLlBsYXllci5sb2FkKHF1ZXVlW3F1ZXVlX3Bvc2l0aW9uXSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBjb25zdCB1cGRhdGVUaW1lbGluZVxyXG5cclxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4gICAgLy8gYXBwLlBsYXllci5za2lwVG9Qb3NpdGlvbigpXHJcbiAgICBjb25zdCBsb2FkID0gKHNvbmcpID0+IHtcclxuICAgICAgICAvLyBQYXVzYSBhIHJlcHJvZHXDp8OjbywgcmVzZXRhIG8gdGVtcG8gZSBjYXJyZWdhIGEgbm92YSBtw7pzaWNhXHJcbiAgICAgICAgYXBwLlBsYXllci5wYXVzZSgpO1xyXG4gICAgICAgICRwbGF5ZXIuY3VycmVudFRpbWUgPSAwO1xyXG4gICAgICAgICRwbGF5ZXIuc3JjID0gc29uZ1tcImZpbGVcIl07XHJcblxyXG4gICAgICAgIC8vIEF0dWFsaXphIGFzIGluZm9ybWHDp8O1ZXMgc29icmUgYSBtw7pzaWNhIGVtIHJlcHJvZHXDp8Ojb1xyXG4gICAgICAgICRucC5zb25nLnRleHQoc29uZ1tcInRpdGxlXCJdKTtcclxuICAgICAgICAkbnAuYXJ0aXN0LnRleHQoc29uZ1tcImFydGlzdFwiXSk7XHJcbiAgICAgICAgJG5wLmFsYnVtLnRleHQoc29uZ1tcImFsYnVtXCJdKTtcclxuICAgICAgICAkbnAuY292ZXIuY3NzKFwiYmFja2dyb3VuZC1pbWFnZVwiLCBcInVybCgnXCIgKyBzb25nW1wiY292ZXJcIl0gKyBcIicpXCIpO1xyXG5cclxuICAgICAgICAvLyBBdHVhbGl6YSBkYWRvcyBkYSBNZWRpYSBTZXNzaW9uIEFQSVxyXG4gICAgICAgIGlmIChcIm1lZGlhU2Vzc2lvblwiIGluIG5hdmlnYXRvcikge1xyXG4gICAgICAgICAgICBuYXZpZ2F0b3IubWVkaWFTZXNzaW9uLm1ldGFkYXRhID0gbmV3IE1lZGlhTWV0YWRhdGEoe1xyXG4gICAgICAgICAgICAgICAgXCJ0aXRsZVwiOiBzb25nW1widGl0bGVcIl0sXHJcbiAgICAgICAgICAgICAgICBcImFydGlzdFwiOiBzb25nW1wiYXJ0aXN0XCJdLFxyXG4gICAgICAgICAgICAgICAgXCJhbGJ1bVwiOiBzb25nW1wiYWxidW1cIl0sXHJcbiAgICAgICAgICAgICAgICBcImFydHdvcmtcIjogW1xyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJzcmNcIjogc29uZ1tcImNvdmVyXCJdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInNpemVzXCI6IFwiNTEyeDUxMlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInR5cGVcIjogXCJpbWFnZS9wbmdcIlxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBJbmljaWEgYSByZXByb2R1w6fDo29cclxuICAgICAgICBhcHAuUGxheWVyLnBsYXkoKTtcclxuICAgIH07XHJcblxyXG5cclxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4gICAgLy8gYXBwLlBsYXllci5za2lwVG9Qb3NpdGlvbigpXHJcbiAgICBjb25zdCBza2lwVG9Qb3NpdGlvbiA9IChzZWNvbmRzKSA9PiB7XHJcbiAgICAgICAgJHBsYXllci5jdXJyZW50VGltZSA9IHNlY29uZHM7XHJcbiAgICB9O1xyXG5cclxuXHJcbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuICAgIC8vIGFwcC5QbGF5ZXIucGxheSgpXHJcbiAgICBjb25zdCBwbGF5ID0gKCkgPT4ge1xyXG4gICAgICAgICRwbGF5ZXIucGxheSgpO1xyXG4gICAgICAgICRucC5yZW1vdmVDbGFzcyhcIi1zdGF0ZS0tcGF1c2VkXCIpLmFkZENsYXNzKFwiLXN0YXRlLS1wbGF5aW5nXCIpO1xyXG4gICAgfTtcclxuXHJcblxyXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbiAgICAvLyBhcHAuUGxheWVyLnBhdXNlKClcclxuICAgIGNvbnN0IHBhdXNlID0gKCkgPT4ge1xyXG4gICAgICAgICRwbGF5ZXIucGF1c2UoKTtcclxuICAgICAgICAkbnAucmVtb3ZlQ2xhc3MoXCItc3RhdGUtLXBsYXlpbmdcIikuYWRkQ2xhc3MoXCItc3RhdGUtLXBhdXNlZFwiKTtcclxuICAgIH07XHJcblxyXG5cclxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4gICAgLy8gYXBwLlBsYXllci5wbGF5UGF1c2UoKVxyXG4gICAgY29uc3QgcGxheVBhdXNlID0gKCkgPT4ge1xyXG4gICAgICAgIGlmICgkcGxheWVyLnBhdXNlZCkge1xyXG4gICAgICAgICAgICBhcHAuUGxheWVyLnBsYXkoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBhcHAuUGxheWVyLnBhdXNlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcImR1cmF0aW9uXCIsICRwbGF5ZXIuZHVyYXRpb24pO1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwidm9sdW1lXCIsICRwbGF5ZXIudm9sdW1lKTtcclxuXHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJidWZmZXJlZFwiLCAkcGxheWVyLmJ1ZmZlcmVkKTtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIm5ldHdvcmtTdGF0ZVwiLCAkcGxheWVyLm5ldHdvcmtTdGF0ZSk7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJwbGF5ZWRcIiwgJHBsYXllci5wbGF5ZWQpO1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwicmVhZHlTdGF0ZVwiLCAkcGxheWVyLnJlYWR5U3RhdGUpO1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwic2Vla2FibGVcIiwgJHBsYXllci5zZWVrYWJsZSk7XHJcbiAgICB9O1xyXG5cclxuXHJcbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuICAgIC8vIGFwcC5QbGF5ZXIucHJldmlvdXNUcmFjaygpXHJcbiAgICBjb25zdCBwcmV2aW91c1RyYWNrID0gKCkgPT4ge1xyXG4gICAgICAgIHF1ZXVlX3Bvc2l0aW9uID0gKHF1ZXVlX3Bvc2l0aW9uIC0gMSArIHF1ZXVlLmxlbmd0aCkgJSBxdWV1ZS5sZW5ndGg7XHJcbiAgICAgICAgYXBwLlBsYXllci5sb2FkKHF1ZXVlW3F1ZXVlX3Bvc2l0aW9uXSk7XHJcbiAgICB9O1xyXG5cclxuXHJcbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuICAgIC8vIGFwcC5QbGF5ZXIubmV4dFRyYWNrKClcclxuICAgIGNvbnN0IG5leHRUcmFjayA9ICgpID0+IHtcclxuICAgICAgICBxdWV1ZV9wb3NpdGlvbiA9IChxdWV1ZV9wb3NpdGlvbiArIDEpICUgcXVldWUubGVuZ3RoO1xyXG4gICAgICAgIGFwcC5QbGF5ZXIubG9hZChxdWV1ZVtxdWV1ZV9wb3NpdGlvbl0pO1xyXG4gICAgfTtcclxuXHJcblxyXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBsb2FkLFxyXG4gICAgICAgIHNraXBUb1Bvc2l0aW9uLFxyXG4gICAgICAgIHBsYXksXHJcbiAgICAgICAgcGF1c2UsXHJcbiAgICAgICAgcGxheVBhdXNlLFxyXG4gICAgICAgIHByZXZpb3VzVHJhY2ssXHJcbiAgICAgICAgbmV4dFRyYWNrXHJcbiAgICB9O1xyXG59KSgpO1xyXG5cclxuaWYgKFwibWVkaWFTZXNzaW9uXCIgaW4gbmF2aWdhdG9yKSB7XHJcbiAgICBuYXZpZ2F0b3IubWVkaWFTZXNzaW9uLnNldEFjdGlvbkhhbmRsZXIoXCJwbGF5XCIsIGFwcC5QbGF5ZXIucGxheSk7XHJcbiAgICBuYXZpZ2F0b3IubWVkaWFTZXNzaW9uLnNldEFjdGlvbkhhbmRsZXIoXCJwYXVzZVwiLCBhcHAuUGxheWVyLnBhdXNlKTtcclxuICAgIC8vIG5hdmlnYXRvci5tZWRpYVNlc3Npb24uc2V0QWN0aW9uSGFuZGxlcihcInNlZWtiYWNrd2FyZFwiLCBmdW5jdGlvbiAoKSB7IH0pO1xyXG4gICAgLy8gbmF2aWdhdG9yLm1lZGlhU2Vzc2lvbi5zZXRBY3Rpb25IYW5kbGVyKFwic2Vla2ZvcndhcmRcIiwgZnVuY3Rpb24gKCkgeyB9KTtcclxuICAgIG5hdmlnYXRvci5tZWRpYVNlc3Npb24uc2V0QWN0aW9uSGFuZGxlcihcInByZXZpb3VzdHJhY2tcIiwgYXBwLlBsYXllci5wcmV2aW91c1RyYWNrKTtcclxuICAgIG5hdmlnYXRvci5tZWRpYVNlc3Npb24uc2V0QWN0aW9uSGFuZGxlcihcIm5leHR0cmFja1wiLCBhcHAuUGxheWVyLm5leHRUcmFjayk7XHJcbn1cclxuIiwiLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4vLyBhcnRpc3QgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcbmFwcC5BcnRpc3QgPSAoKCkgPT4ge1xyXG5cclxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4gICAgLy8gYXBwLkFydGlzdC5sb2FkKClcclxuICAgIGNvbnN0IGxvYWQgPSAoYXJ0aXN0X2lkKSA9PiB7XHJcbiAgICAgICAgJC5nZXQoXCJkYXRhL2FydGlzdHMvXCIgKyBhcnRpc3RfaWQgKyBcIi5qc29uXCIpLmRvbmUoKHJlc3BvbnNlKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBhcnRpc3QgPSByZXNwb25zZTtcclxuICAgICAgICAgICAgbGV0ICRhcnRpc3QgPSBfX3JlbmRlcihcImFydGlzdFwiLCBhcnRpc3QpO1xyXG5cclxuICAgICAgICAgICAgLy8gw4FsYnVuc1xyXG4gICAgICAgICAgICBsZXQgYWxidW1zID0gYXJ0aXN0W1wiYWxidW1zXCJdO1xyXG4gICAgICAgICAgICBsZXQgJGFsYnVtcyA9ICQoXCIuYWxidW1zXCIsICRhcnRpc3QpO1xyXG5cclxuICAgICAgICAgICAgYWxidW1zLmZvckVhY2goKGFsYnVtKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBhbGJ1bVtcImNvdmVyLWFydFwiXSA9IFwiYmFja2dyb3VuZC1pbWFnZTogdXJsKCdcIiArIGFsYnVtW1wiY292ZXJcIl0gKyBcIicpXCI7XHJcbiAgICAgICAgICAgICAgICBsZXQgJGFsYnVtID0gX19yZW5kZXIoXCJhcnRpc3QtYWxidW1cIiwgYWxidW0pLmFwcGVuZFRvKCRhbGJ1bXMpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIEhpdHNcclxuICAgICAgICAgICAgbGV0IGhpdHMgPSBhcnRpc3RbXCJoaXRzXCJdO1xyXG4gICAgICAgICAgICBsZXQgJGhpdHMgPSAkKFwiLmhpdHNcIiwgJGFydGlzdCk7XHJcblxyXG4gICAgICAgICAgICBoaXRzLmZvckVhY2goKGhpdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaGl0W1wiZm9ybWF0dGVkLWxlbmd0aFwiXSA9IGR1cmF0aW9uKGhpdFtcImxlbmd0aFwiXSk7XHJcbiAgICAgICAgICAgICAgICBsZXQgJGhpdCA9IF9fcmVuZGVyKFwiYXJ0aXN0LWhpdFwiLCBoaXQpLmFwcGVuZFRvKCRoaXRzKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBDb2xvY2EgbmEgdGVsYVxyXG4gICAgICAgICAgICAkdWlbXCJsaWJyYXJ5XCJdLmVtcHR5KCkuYXBwZW5kKCRhcnRpc3QpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcblxyXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBsb2FkXHJcbiAgICB9O1xyXG59KSgpO1xyXG4iLCIvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbi8vIHN0YXJ0IC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuJChmdW5jdGlvbigpIHtcclxuICAgIGFwcC5BcnRpc3QubG9hZChcInRoZS1iZWF0bGVzXCIpO1xyXG59KTtcclxuIl19
