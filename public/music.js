"use strict";

////////////////////////////////////////////////////////////////////////////////////////////////////
// base ////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////
var app = {};
var ui = {};
var $ui = {};
var cue = {}; // TODO: mover para lugar apropriado

$(function () {
  $ui["library"] = $(".library");
});

var duration = function duration(seconds) {
  return moment.utc(moment.duration(seconds, "seconds").asMilliseconds()).format("m:ss");
}; ////////////////////////////////////////////////////////////////////////////////////////////////////
// core / template engine //////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////


ui.template = function () {
  var $templates = {};
  $(function () {
    $("template").each(function () {
      var $this = $(this);
      var name = $this.attr("id");
      var html = $this.html();
      $templates[name] = $(html);
      $this.remove();
    });
  });

  var render = function render(template, data) {
    if (!$templates[template]) {
      return false;
    }

    var $render = $templates[template].clone();
    $render.data(data);

    $.fn.fillBlanks = function () {
      var $blank = $(this);
      var fill = $blank.data("fill");
      var rules = fill.split(",");

      for (var i = 0; i < rules.length; i++) {
        var pair = rules[i].split(":");
        var dest = pair[1] ? pair[0].trim() : "html";
        var source = pair[1] ? pair[1].trim() : pair[0];
        var value = data[source];
        source = source.split("/");

        if (source.length > 1 && typeof value !== "undefined") {
          value = data[source[0]];

          for (var j = 1; j < source.length; j++) {
            value = value[source[j]] ? value[source[j]] : null;
          }
        }

        if (typeof value !== "undefined" && value !== null) {
          if (dest === "class") {
            $blank.addClass(value);
          } else if (dest === "html") {
            $blank.html(value);
          } else if (dest === "value") {
            $blank.val(value);
          } else {
            $blank.attr(dest, value);
          }
        } else {
          var if_null = $blank.data("fill-null");

          if (if_null === "hide") {
            $blank.hide();
          } else if (if_null === "remove") {
            $blank.remove();
          }
        }
      }

      $blank.removeClass("fill").removeAttr("data-fill").removeAttr("data-fill-null");
    };

    if ($render.hasClass("fill")) {
      $render.fillBlanks();
    }

    $(".fill", $render).each(function () {
      $(this).fillBlanks();
    });
    return $render;
  };

  return {
    render: render
  };
}();

var __render = ui.template.render; ////////////////////////////////////////////////////////////////////////////////////////////////////
// artist //////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

app.Artist = function () {
  ////////////////////////////////////////////////////////////////////////////////////////////////
  // app.Artist.load()
  var load = function load(artist_id) {
    $.get("data/artists/" + artist_id + ".json").done(function (response) {
      var artist = response;

      var $artist = __render("artist", artist); // Álbuns


      var albums = artist["albums"];
      var $albums = $(".albums", $artist);
      albums.forEach(function (album) {
        album["cover-art"] = "background-image: url('" + album["cover"] + "')";

        var $album = __render("artist-album", album).appendTo($albums);
      }); // Hits

      var hits = artist["hits"];
      var $hits = $(".hits", $artist);
      hits.forEach(function (hit) {
        hit["formatted-length"] = duration(hit["length"]);

        var $hit = __render("artist-hit", hit).appendTo($hits);
      }); // Coloca na tela

      $ui["library"].empty().append($artist);
    });
  }; ////////////////////////////////////////////////////////////////////////////////////////////////


  return {
    load: load
  };
}(); ////////////////////////////////////////////////////////////////////////////////////////////////////
// start ///////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////


$(function () {
  app.Artist.load("the-beatles");
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJhc2UuanMiLCJ0ZW1wbGF0ZS1lbmdpbmUuanMiLCJhcnRpc3QuanMiLCJzdGFydC5qcyJdLCJuYW1lcyI6WyJhcHAiLCJ1aSIsIiR1aSIsImN1ZSIsIiQiLCJkdXJhdGlvbiIsInNlY29uZHMiLCJtb21lbnQiLCJ1dGMiLCJhc01pbGxpc2Vjb25kcyIsImZvcm1hdCIsInRlbXBsYXRlIiwiJHRlbXBsYXRlcyIsImVhY2giLCIkdGhpcyIsIm5hbWUiLCJhdHRyIiwiaHRtbCIsInJlbW92ZSIsInJlbmRlciIsImRhdGEiLCIkcmVuZGVyIiwiY2xvbmUiLCJmbiIsImZpbGxCbGFua3MiLCIkYmxhbmsiLCJmaWxsIiwicnVsZXMiLCJzcGxpdCIsImkiLCJsZW5ndGgiLCJwYWlyIiwiZGVzdCIsInRyaW0iLCJzb3VyY2UiLCJ2YWx1ZSIsImoiLCJhZGRDbGFzcyIsInZhbCIsImlmX251bGwiLCJoaWRlIiwicmVtb3ZlQ2xhc3MiLCJyZW1vdmVBdHRyIiwiaGFzQ2xhc3MiLCJfX3JlbmRlciIsIkFydGlzdCIsImxvYWQiLCJhcnRpc3RfaWQiLCJnZXQiLCJkb25lIiwicmVzcG9uc2UiLCJhcnRpc3QiLCIkYXJ0aXN0IiwiYWxidW1zIiwiJGFsYnVtcyIsImZvckVhY2giLCJhbGJ1bSIsIiRhbGJ1bSIsImFwcGVuZFRvIiwiaGl0cyIsIiRoaXRzIiwiaGl0IiwiJGhpdCIsImVtcHR5IiwiYXBwZW5kIl0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0E7QUFDQTtBQUVBLElBQUFBLEdBQUEsR0FBQSxFQUFBO0FBRUEsSUFBQUMsRUFBQSxHQUFBLEVBQUE7QUFDQSxJQUFBQyxHQUFBLEdBQUEsRUFBQTtBQUVBLElBQUFDLEdBQUEsR0FBQSxFQUFBLEMsQ0FLQTs7QUFDQUMsQ0FBQSxDQUFBLFlBQUE7QUFDQUYsRUFBQUEsR0FBQSxDQUFBLFNBQUEsQ0FBQSxHQUFBRSxDQUFBLENBQUEsVUFBQSxDQUFBO0FBQ0EsQ0FGQSxDQUFBOztBQUlBLElBQUFDLFFBQUEsR0FBQSxT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R0FBQSxDQUFBLFFBQUEsQ0FBQSxDQUFBOztBQUNBLFlBQUFDLElBQUEsR0FBQWxCLFFBQUEsQ0FBQSxZQUFBLEVBQUFpQixHQUFBLENBQUEsQ0FBQUgsUUFBQSxDQUFBRSxLQUFBLENBQUE7QUFDQSxPQUhBLEVBakJBLENBc0JBOztBQUNBMUQsTUFBQUEsR0FBQSxDQUFBLFNBQUEsQ0FBQSxDQUFBNkQsS0FBQSxHQUFBQyxNQUFBLENBQUFaLE9BQUE7QUFDQSxLQXhCQTtBQXlCQSxHQTFCQSxDQUpBLENBaUNBOzs7QUFFQSxTQUFBO0FBQ0FOLElBQUFBLElBQUEsRUFBQUE7QUFEQSxHQUFBO0FBR0EsQ0F0Q0EsRUFBQSxDLENDSkE7QUFDQTtBQUNBOzs7QUFFQTFDLENBQUEsQ0FBQSxZQUFBO0FBQ0FKLEVBQUFBLEdBQUEsQ0FBQTZDLE1BQUEsQ0FBQUMsSUFBQSxDQUFBLGFBQUE7QUFDQSxDQUZBLENBQUEiLCJmaWxlIjoibXVzaWMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbi8vIGJhc2UgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxubGV0IGFwcCA9IHsgfTtcclxuXHJcbmxldCB1aSA9IHsgfTtcclxubGV0ICR1aSA9IHsgfTtcclxuXHJcbmxldCBjdWUgPSB7IH07XHJcblxyXG5cclxuXHJcblxyXG4vLyBUT0RPOiBtb3ZlciBwYXJhIGx1Z2FyIGFwcm9wcmlhZG9cclxuJChmdW5jdGlvbigpIHtcclxuICAgICR1aVtcImxpYnJhcnlcIl0gPSAkKFwiLmxpYnJhcnlcIik7XHJcbn0pO1xyXG5cclxuY29uc3QgZHVyYXRpb24gPSAoc2Vjb25kcykgPT4ge1xyXG4gICAgcmV0dXJuIG1vbWVudC51dGMobW9tZW50LmR1cmF0aW9uKHNlY29uZHMsIFwic2Vjb25kc1wiKS5hc01pbGxpc2Vjb25kcygpKS5mb3JtYXQoXCJtOnNzXCIpO1xyXG59O1xyXG4iLCIvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbi8vIGNvcmUgLyB0ZW1wbGF0ZSBlbmdpbmUgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxudWkudGVtcGxhdGUgPSAoKCkgPT4ge1xyXG4gICAgbGV0ICR0ZW1wbGF0ZXMgPSB7IH07XHJcblxyXG4gICAgJChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgJChcInRlbXBsYXRlXCIpLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpO1xyXG4gICAgICAgICAgICB2YXIgbmFtZSA9ICR0aGlzLmF0dHIoXCJpZFwiKTtcclxuICAgICAgICAgICAgdmFyIGh0bWwgPSAkdGhpcy5odG1sKCk7XHJcblxyXG4gICAgICAgICAgICAkdGVtcGxhdGVzW25hbWVdID0gJChodG1sKTtcclxuICAgICAgICAgICAgJHRoaXMucmVtb3ZlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCByZW5kZXIgPSAodGVtcGxhdGUsIGRhdGEpID0+IHtcclxuICAgICAgICBpZiAoISR0ZW1wbGF0ZXNbdGVtcGxhdGVdKSB7IHJldHVybiBmYWxzZTsgfVxyXG4gICAgICAgIHZhciAkcmVuZGVyID0gJHRlbXBsYXRlc1t0ZW1wbGF0ZV0uY2xvbmUoKTtcclxuXHJcbiAgICAgICAgJHJlbmRlci5kYXRhKGRhdGEpO1xyXG5cclxuICAgICAgICAkLmZuLmZpbGxCbGFua3MgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciAkYmxhbmsgPSAkKHRoaXMpO1xyXG4gICAgICAgICAgICB2YXIgZmlsbCA9ICRibGFuay5kYXRhKFwiZmlsbFwiKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBydWxlcyA9IGZpbGwuc3BsaXQoXCIsXCIpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJ1bGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcGFpciA9IHJ1bGVzW2ldLnNwbGl0KFwiOlwiKTtcclxuICAgICAgICAgICAgICAgIHZhciBkZXN0ID0gKHBhaXJbMV0gPyBwYWlyWzBdLnRyaW0oKSA6IFwiaHRtbFwiKTtcclxuICAgICAgICAgICAgICAgIHZhciBzb3VyY2UgPSAocGFpclsxXSA/IHBhaXJbMV0udHJpbSgpIDogcGFpclswXSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBkYXRhW3NvdXJjZV07XHJcblxyXG4gICAgICAgICAgICAgICAgc291cmNlID0gc291cmNlLnNwbGl0KFwiL1wiKTtcclxuICAgICAgICAgICAgICAgIGlmIChzb3VyY2UubGVuZ3RoID4gMSAmJiB0eXBlb2YgdmFsdWUgIT09IFwidW5kZWZpbmVkXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGRhdGFbc291cmNlWzBdXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDE7IGogPCBzb3VyY2UubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAodmFsdWVbc291cmNlW2pdXSkgPyB2YWx1ZVtzb3VyY2Vbal1dIDogbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB2YWx1ZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkZXN0ID09PSBcImNsYXNzXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGJsYW5rLmFkZENsYXNzKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRlc3QgPT09IFwiaHRtbFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRibGFuay5odG1sKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRlc3QgPT09IFwidmFsdWVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkYmxhbmsudmFsKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkYmxhbmsuYXR0cihkZXN0LCB2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWZfbnVsbCA9ICRibGFuay5kYXRhKFwiZmlsbC1udWxsXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpZl9udWxsID09PSBcImhpZGVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkYmxhbmsuaGlkZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaWZfbnVsbCA9PT0gXCJyZW1vdmVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkYmxhbmsucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkYmxhbmtcclxuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImZpbGxcIilcclxuICAgICAgICAgICAgICAgIC5yZW1vdmVBdHRyKFwiZGF0YS1maWxsXCIpXHJcbiAgICAgICAgICAgICAgICAucmVtb3ZlQXR0cihcImRhdGEtZmlsbC1udWxsXCIpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmICgkcmVuZGVyLmhhc0NsYXNzKFwiZmlsbFwiKSkge1xyXG4gICAgICAgICAgICAkcmVuZGVyLmZpbGxCbGFua3MoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICQoXCIuZmlsbFwiLCAkcmVuZGVyKS5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJCh0aGlzKS5maWxsQmxhbmtzKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiAkcmVuZGVyO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgcmVuZGVyXHJcbiAgICB9O1xyXG59KSgpO1xyXG5cclxubGV0IF9fcmVuZGVyID0gdWkudGVtcGxhdGUucmVuZGVyO1xyXG4iLCIvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbi8vIGFydGlzdCAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuYXBwLkFydGlzdCA9ICgoKSA9PiB7XHJcblxyXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbiAgICAvLyBhcHAuQXJ0aXN0LmxvYWQoKVxyXG4gICAgY29uc3QgbG9hZCA9IChhcnRpc3RfaWQpID0+IHtcclxuICAgICAgICAkLmdldChcImRhdGEvYXJ0aXN0cy9cIiArIGFydGlzdF9pZCArIFwiLmpzb25cIikuZG9uZSgocmVzcG9uc2UpID0+IHtcclxuICAgICAgICAgICAgbGV0IGFydGlzdCA9IHJlc3BvbnNlO1xyXG4gICAgICAgICAgICBsZXQgJGFydGlzdCA9IF9fcmVuZGVyKFwiYXJ0aXN0XCIsIGFydGlzdCk7XHJcblxyXG4gICAgICAgICAgICAvLyDDgWxidW5zXHJcbiAgICAgICAgICAgIGxldCBhbGJ1bXMgPSBhcnRpc3RbXCJhbGJ1bXNcIl07XHJcbiAgICAgICAgICAgIGxldCAkYWxidW1zID0gJChcIi5hbGJ1bXNcIiwgJGFydGlzdCk7XHJcblxyXG4gICAgICAgICAgICBhbGJ1bXMuZm9yRWFjaCgoYWxidW0pID0+IHtcclxuICAgICAgICAgICAgICAgIGFsYnVtW1wiY292ZXItYXJ0XCJdID0gXCJiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJ1wiICsgYWxidW1bXCJjb3ZlclwiXSArIFwiJylcIjtcclxuICAgICAgICAgICAgICAgIGxldCAkYWxidW0gPSBfX3JlbmRlcihcImFydGlzdC1hbGJ1bVwiLCBhbGJ1bSkuYXBwZW5kVG8oJGFsYnVtcyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gSGl0c1xyXG4gICAgICAgICAgICBsZXQgaGl0cyA9IGFydGlzdFtcImhpdHNcIl07XHJcbiAgICAgICAgICAgIGxldCAkaGl0cyA9ICQoXCIuaGl0c1wiLCAkYXJ0aXN0KTtcclxuXHJcbiAgICAgICAgICAgIGhpdHMuZm9yRWFjaCgoaGl0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBoaXRbXCJmb3JtYXR0ZWQtbGVuZ3RoXCJdID0gZHVyYXRpb24oaGl0W1wibGVuZ3RoXCJdKTtcclxuICAgICAgICAgICAgICAgIGxldCAkaGl0ID0gX19yZW5kZXIoXCJhcnRpc3QtaGl0XCIsIGhpdCkuYXBwZW5kVG8oJGhpdHMpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIENvbG9jYSBuYSB0ZWxhXHJcbiAgICAgICAgICAgICR1aVtcImxpYnJhcnlcIl0uZW1wdHkoKS5hcHBlbmQoJGFydGlzdCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuXHJcbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGxvYWRcclxuICAgIH07XHJcbn0pKCk7XHJcbiIsIi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuLy8gc3RhcnQgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG4kKGZ1bmN0aW9uKCkge1xyXG4gICAgYXBwLkFydGlzdC5sb2FkKFwidGhlLWJlYXRsZXNcIik7XHJcbn0pO1xyXG4iXX0=
