"use strict";

////////////////////////////////////////////////////////////////////////////////////////////////////
// base ////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////
var app = {};
var ui = {};
var $ui = {};
var cue = {}; // TODO: mover para lugar apropriado

$(function () {
  $ui["library"] = $(".library");
});

var duration = function duration(seconds) {
  return moment.utc(moment.duration(seconds, "seconds").asMilliseconds()).format("m:ss");
}; ////////////////////////////////////////////////////////////////////////////////////////////////////
// core / template engine //////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////


ui.template = function () {
  var $templates = {};
  $(function () {
    $("template").each(function () {
      var $this = $(this);
      var name = $this.attr("id");
      var html = $this.html();
      $templates[name] = $(html);
      $this.remove();
    });
  });

  var render = function render(template, data) {
    if (!$templates[template]) {
      return false;
    }

    var $render = $templates[template].clone();
    $render.data(data);

    $.fn.fillBlanks = function () {
      var $blank = $(this);
      var fill = $blank.data("fill");
      var rules = fill.split(",");

      for (var i = 0; i < rules.length; i++) {
        var pair = rules[i].split(":");
        var dest = pair[1] ? pair[0].trim() : "html";
        var source = pair[1] ? pair[1].trim() : pair[0];
        var value = data[source];
        source = source.split("/");

        if (source.length > 1 && typeof value !== "undefined") {
          value = data[source[0]];

          for (var j = 1; j < source.length; j++) {
            value = value[source[j]] ? value[source[j]] : null;
          }
        }

        if (typeof value !== "undefined" && value !== null) {
          if (dest === "class") {
            $blank.addClass(value);
          } else if (dest === "html") {
            $blank.html(value);
          } else if (dest === "value") {
            $blank.val(value);
          } else {
            $blank.attr(dest, value);
          }
        } else {
          var if_null = $blank.data("fill-null");

          if (if_null === "hide") {
            $blank.hide();
          } else if (if_null === "remove") {
            $blank.remove();
          }
        }
      }

      $blank.removeClass("fill").removeAttr("data-fill").removeAttr("data-fill-null");
    };

    if ($render.hasClass("fill")) {
      $render.fillBlanks();
    }

    $(".fill", $render).each(function () {
      $(this).fillBlanks();
    });
    return $render;
  };

  return {
    render: render
  };
}();

var __render = ui.template.render; ////////////////////////////////////////////////////////////////////////////////////////////////////
// player //////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

$(function () {
  $ui["player"] = $("audio.player")[0];
  $ui["now-playing"] = $(".now-playing");
  $(".play", $ui["now-playing"]).on("click", app.Player.toggle);
});

app.Player = function () {
  var toggle = function toggle() {
    if ($ui["player"].paused) {
      $ui["player"].play();
    } else {
      $ui["player"].pause();
    }
  };

  return {
    toggle: toggle
  };
}(); ////////////////////////////////////////////////////////////////////////////////////////////////////
// artist //////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////


app.Artist = function () {
  ////////////////////////////////////////////////////////////////////////////////////////////////
  // app.Artist.load()
  var load = function load(artist_id) {
    $.get("data/artists/" + artist_id + ".json").done(function (response) {
      var artist = response;

      var $artist = __render("artist", artist); // Álbuns


      var albums = artist["albums"];
      var $albums = $(".albums", $artist);
      albums.forEach(function (album) {
        album["cover-art"] = "background-image: url('" + album["cover"] + "')";

        var $album = __render("artist-album", album).appendTo($albums);
      }); // Hits

      var hits = artist["hits"];
      var $hits = $(".hits", $artist);
      hits.forEach(function (hit) {
        hit["formatted-length"] = duration(hit["length"]);

        var $hit = __render("artist-hit", hit).appendTo($hits);
      }); // Coloca na tela

      $ui["library"].empty().append($artist);
    });
  }; ////////////////////////////////////////////////////////////////////////////////////////////////


  return {
    load: load
  };
}(); ////////////////////////////////////////////////////////////////////////////////////////////////////
// start ///////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////


$(function () {
  app.Artist.load("the-beatles");
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJhc2UuanMiLCJ0ZW1wbGF0ZS1lbmdpbmUuanMiLCJwbGF5ZXIuanMiLCJhcnRpc3QuanMiLCJzdGFydC5qcyJdLCJuYW1lcyI6WyJhcHAiLCJ1aSIsIiR1aSIsImN1ZSIsIiQiLCJkdXJhdGlvbiIsInNlY29uZHMiLCJtb21lbnQiLCJ1dGMiLCJhc01pbGxpc2Vjb25kcyIsImZvcm1hdCIsInRlbXBsYXRlIiwiJHRlbXBsYXRlcyIsImVhY2giLCIkdGhpcyIsIm5hbWUiLCJhdHRyIiwiaHRtbCIsInJlbW92ZSIsInJlbmRlciIsImRhdGEiLCIkcmVuZGVyIiwiY2xvbmUiLCJmbiIsImZpbGxCbGFua3MiLCIkYmxhbmsiLCJmaWxsIiwicnVsZXMiLCJzcGxpdCIsImkiLCJsZW5ndGgiLCJwYWlyIiwiZGVzdCIsInRyaW0iLCJzb3VyY2UiLCJ2YWx1ZSIsImoiLCJhZGRDbGFzcyIsInZhbCIsImlmX251bGwiLCJoaWRlIiwicmVtb3ZlQ2xhc3MiLCJyZW1vdmVBdHRyIiwiaGFzQ2xhc3MiLCJfX3JlbmRlciIsIm9uIiwiUGxheWVyIiwidG9nZ2xlIiwicGF1c2VkIiwicGxheSIsInBhdXNlIiwiQXJ0aXN0IiwibG9hZCIsImFydGlzdF9pZCIsImdldCIsImRvbmUiLCJyZXNwb25zZSIsImFydGlzdCIsIiRhcnRpc3QiLCJhbGJ1bXMiLCIkYWxidW1zIiwiZm9yRWFjaCIsImFsYnVtIiwiJGFsYnVtIiwiYXBwZW5kVG8iLCJoaXRzIiwiJGhpdHMiLCJoaXQiLCIkaGl0IiwiZW1wdHkiLCJhcHBlbmQiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBRUEsSUFBQUEsR0FBQSxHQUFBLEVBQUE7QUFFQSxJQUFBQyxFQUFBLEdBQUEsRUFBQTtBQUNBLElBQUFDLEdBQUEsR0FBQSxFQUFBO0FBRUEsSUFBQUMsR0FBQSxHQUFBLEVBQUEsQyxDQUtBOztBQUNBQyxDQUFBLENBQUEsWUFBQTtBQUNBRixFQUFBQSxHQUFBLENBQUEsU0FBQSxDQUFBLEdBQUFFLENBQUEsQ0FBQSxVQUFBLENBQUE7QUFDQSxDQUZBLENBQUE7O0FBSUEsSUFBQUMsUUFBQSxHQUFBLFNBQUFBLFFBQUEsQ0FBQUMsT0FBQSxFQUFBO0FBQ0EsU0FBQUMsTUFBQSxDQUFBQyxHQUFBLENBQUFELE1BQUEsQ0FBQUYsUUFBQSxDQUFBQyxPQUFBLEVBQUEsU0FBQSxFQUFBRyxjQUFBLEVBQUEsRUFBQUMsTUFBQSxDQUFBLE1BQUEsQ0FBQTtBQUNBLENBRkEsQyxDQ25CQTtBQUNBO0FBQ0E7OztBQUVBVCxFQUFBLENBQUFVLFFBQUEsR0FBQSxZQUFBO0FBQ0EsTUFBQUMsVUFBQSxHQUFBLEVBQUE7QUFFQVIsRUFBQUEsQ0FBQSxDQUFBLFlBQUE7QUFDQUEsSUFBQUEsQ0FBQSxDQUFBLFVBQUEsQ0FBQSxDQUFBUyxJQUFBLENBQUEsWUFBQTtBQUNBLFVBQUFDLEtBQUEsR0FBQVYsQ0FBQSxDQUFBLElBQUEsQ0FBQTtBQUNBLFVBQUFXLElBQUEsR0FBQUQsS0FBQSxDQUFBRSxJQUFBLENBQUEsSUFBQSxDQUFBO0FBQ0EsVUFBQUMsSUFBQSxHQUFBSCxLQUFBLENBQUFHLElBQUEsRUFBQTtBQUVBTCxNQUFBQSxVQUFBLENBQUFHLElBQUEsQ0FBQSxHQUFBWCxDQUFBLENBQUFhLElBQUEsQ0FBQTtBQUNBSCxNQUFBQSxLQUFBLENBQUFJLE1BQUE7QUFDQSxLQVBBO0FBUUEsR0FUQSxDQUFBOztBQVdBLE1BQUFDLE1BQUEsR0FBQSxTQUFBQSxNQUFBLENBQUFSLFFBQUEsRUFBQVMsSUFBQSxFQUFBO0FBQ0EsUUFBQSxDQUFBUixVQUFBLENBQUFELFFBQUEsQ0FBQSxFQUFBO0FBQUEsYUFBQSxLQUFBO0FBQUE7O0FBQ0EsUUFBQVUsT0FBQSxHQUFBVCxVQUFBLENBQUFELFFBQUEsQ0FBQSxDQUFBVyxLQUFBLEVBQUE7QUFFQUQsSUFBQUEsT0FBQSxDQUFBRCxJQUFBLENBQUFBLElBQUE7O0FBRUFoQixJQUFBQSxDQUFBLENBQUFtQixFQUFBLENBQUFDLFVBQUEsR0FBQSxZQUFBO0FBQ0EsVUFBQUMsTUFBQSxHQUFBckIsQ0FBQSxDQUFBLElBQUEsQ0FBQTtBQUNBLFVBQUFzQixJQUFBLEdBQUFELE1BQUEsQ0FBQUwsSUFBQSxDQUFBLE1BQUEsQ0FBQTtBQUVBLFVBQUFPLEtBQUEsR0FBQUQsSUFBQSxDQUFBRSxLQUFBLENBQUEsR0FBQSxDQUFBOztBQUNBLFdBQUEsSUFBQUMsQ0FBQSxHQUFBLENBQUEsRUFBQUEsQ0FBQSxHQUFBRixLQUFBLENBQUFHLE1BQUEsRUFBQUQsQ0FBQSxFQUFBLEVBQUE7QUFDQSxZQUFBRSxJQUFBLEdBQUFKLEtBQUEsQ0FBQUUsQ0FBQSxDQUFBLENBQUFELEtBQUEsQ0FBQSxHQUFBLENBQUE7QUFDQSxZQUFBSSxJQUFBLEdBQUFELElBQUEsQ0FBQSxDQUFBLENBQUEsR0FBQUEsSUFBQSxDQUFBLENBQUEsQ0FBQSxDQUFBRSxJQUFBLEVBQUEsR0FBQSxNQUFBO0FBQ0EsWUFBQUMsTUFBQSxHQUFBSCxJQUFBLENBQUEsQ0FBQSxDQUFBLEdBQUFBLElBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQUUsSUFBQSxFQUFBLEdBQUFGLElBQUEsQ0FBQSxDQUFBLENBQUE7QUFDQSxZQUFBSSxLQUFBLEdBQUFmLElBQUEsQ0FBQWMsTUFBQSxDQUFBO0FBRUFBLFFBQUFBLE1BQUEsR0FBQUEsTUFBQSxDQUFBTixLQUFBLENBQUEsR0FBQSxDQUFBOztBQUNBLFlBQUFNLE1BQUEsQ0FBQUosTUFBQSxHQUFBLENBQUEsSUFBQSxPQUFBSyxLQUFBLEtBQUEsV0FBQSxFQUFBO0FBQ0FBLFVBQUFBLEtBQUEsR0FBQWYsSUFBQSxDQUFBYyxNQUFBLENBQUEsQ0FBQSxDQUFBLENBQUE7O0FBRUEsZUFBQSxJQUFBRSxDQUFBLEdBQUEsQ0FBQSxFQUFBQSxDQUFBLEdBQUFGLE1BQUEsQ0FBQUosTUFBQSxFQUFBTSxDQUFBLEVBQUEsRUFBQTtBQUNBRCxZQUFBQSxLQUFBLEdBQUFBLEtBQUEsQ0FBQUQsTUFBQSxDQUFBRSxDQUFBLENBQUEsQ0FBQSxHQUFBRCxLQUFBLENBQUFELE1BQUEsQ0FBQUUsQ0FBQSxDQUFBLENBQUEsR0FBQSxJQUFBO0FBQ0E7QUFDQTs7QUFFQSxZQUFBLE9BQUFELEtBQUEsS0FBQSxXQUFBLElBQUFBLEtBQUEsS0FBQSxJQUFBLEVBQUE7QUFDQSxjQUFBSCxJQUFBLEtBQUEsT0FBQSxFQUFBO0FBQ0FQLFlBQUFBLE1BQUEsQ0FBQVksUUFBQSxDQUFBRixLQUFBO0FBQ0EsV0FGQSxNQUVBLElBQUFILElBQUEsS0FBQSxNQUFBLEVBQUE7QUFDQVAsWUFBQUEsTUFBQSxDQUFBUixJQUFBLENBQUFrQixLQUFBO0FBQ0EsV0FGQSxNQUVBLElBQUFILElBQUEsS0FBQSxPQUFBLEVBQUE7QUFDQVAsWUFBQUEsTUFBQSxDQUFBYSxHQUFBLENBQUFILEtBQUE7QUFDQSxXQUZBLE1BRUE7QUFDQVYsWUFBQUEsTUFBQSxDQUFBVCxJQUFBLENBQUFnQixJQUFBLEVBQUFHLEtBQUE7QUFDQTtBQUNBLFNBVkEsTUFVQTtBQUNBLGNBQUFJLE9BQUEsR0FBQWQsTUFBQSxDQUFBTCxJQUFBLENBQUEsV0FBQSxDQUFBOztBQUNBLGNBQUFtQixPQUFBLEtBQUEsTUFBQSxFQUFBO0FBQ0FkLFlBQUFBLE1BQUEsQ0FBQWUsSUFBQTtBQUNBLFdBRkEsTUFFQSxJQUFBRCxPQUFBLEtBQUEsUUFBQSxFQUFBO0FBQ0FkLFlBQUFBLE1BQUEsQ0FBQVAsTUFBQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQU8sTUFBQUEsTUFBQSxDQUNBZ0IsV0FEQSxDQUNBLE1BREEsRUFFQUMsVUFGQSxDQUVBLFdBRkEsRUFHQUEsVUFIQSxDQUdBLGdCQUhBO0FBSUEsS0E1Q0E7O0FBOENBLFFBQUFyQixPQUFBLENBQUFzQixRQUFBLENBQUEsTUFBQSxDQUFBLEVBQUE7QUFDQXRCLE1BQUFBLE9BQUEsQ0FBQUcsVUFBQTtBQUNBOztBQUVBcEIsSUFBQUEsQ0FBQSxDQUFBLE9BQUEsRUFBQWlCLE9BQUEsQ0FBQSxDQUFBUixJQUFBLENBQUEsWUFBQTtBQUNBVCxNQUFBQSxDQUFBLENBQUEsSUFBQSxDQUFBLENBQUFvQixVQUFBO0FBQ0EsS0FGQTtBQUlBLFdBQUFILE9BQUE7QUFDQSxHQTdEQTs7QUErREEsU0FBQTtBQUNBRixJQUFBQSxNQUFBLEVBQUFBO0FBREEsR0FBQTtBQUdBLENBaEZBLEVBQUE7O0FBa0ZBLElBQUF5QixRQUFBLEdBQUEzQyxFQUFBLENBQUFVLFFBQUEsQ0FBQVEsTUFBQSxDLENDdEZBO0FBQ0E7QUFDQTs7QUFFQWYsQ0FBQSxDQUFBLFlBQUE7QUFDQUYsRUFBQUEsR0FBQSxDQUFBLFFBQUEsQ0FBQSxHQUFBRSxDQUFBLENBQUEsY0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBO0FBRUFGLEVBQUFBLEdBQUEsQ0FBQSxhQUFBLENBQUEsR0FBQUUsQ0FBQSxDQUFBLGNBQUEsQ0FBQTtBQUNBQSxFQUFBQSxDQUFBLENBQUEsT0FBQSxFQUFBRixHQUFBLENBQUEsYUFBQSxDQUFBLENBQUEsQ0FBQTJDLEVBQUEsQ0FBQSxPQUFBLEVBQUE3QyxHQUFBLENBQUE4QyxNQUFBLENBQUFDLE1BQUE7QUFDQSxDQUxBLENBQUE7O0FBT0EvQyxHQUFBLENBQUE4QyxNQUFBLEdBQUEsWUFBQTtBQUNBLE1BQUFDLE1BQUEsR0FBQSxTQUFBQSxNQUFBLEdBQUE7QUFDQSxRQUFBN0MsR0FBQSxDQUFBLFFBQUEsQ0FBQSxDQUFBOEMsTUFBQSxFQUFBO0FBQ0E5QyxNQUFBQSxHQUFBLENBQUEsUUFBQSxDQUFBLENBQUErQyxJQUFBO0FBQ0EsS0FGQSxNQUVBO0FBQ0EvQyxNQUFBQSxHQUFBLENBQUEsUUFBQSxDQUFBLENBQUFnRCxLQUFBO0FBQ0E7QUFDQSxHQU5BOztBQVFBLFNBQUE7QUFDQUgsSUFBQUEsTUFBQSxFQUFBQTtBQURBLEdBQUE7QUFHQSxDQVpBLEVBQUEsQyxDQ1hBO0FBQ0E7QUFDQTs7O0FBRUEvQyxHQUFBLENBQUFtRCxNQUFBLEdBQUEsWUFBQTtBQUVBO0FBQ0E7QUFDQSxNQUFBQyxJQUFBLEdBQUEsU0FBQUEsSUFBQSxDQUFBQyxTQUFBLEVBQUE7QUFDQWpELElBQUFBLENBQUEsQ0FBQWtELEdBQUEsQ0FBQSxrQkFBQUQsU0FBQSxHQUFBLE9BQUEsRUFBQUUsSUFBQSxDQUFBLFVBQUFDLFFBQUEsRUFBQTtBQUNBLFVBQUFDLE1BQUEsR0FBQUQsUUFBQTs7QUFDQSxVQUFBRSxPQUFBLEdBQUFkLFFBQUEsQ0FBQSxRQUFBLEVBQUFhLE1BQUEsQ0FBQSxDQUZBLENBSUE7OztBQUNBLFVBQUFFLE1BQUEsR0FBQUYsTUFBQSxDQUFBLFFBQUEsQ0FBQTtBQUNBLFVBQUFHLE9BQUEsR0FBQXhELENBQUEsQ0FBQSxTQUFBLEVBQUFzRCxPQUFBLENBQUE7QUFFQUMsTUFBQUEsTUFBQSxDQUFBRSxPQUFBLENBQUEsVUFBQUMsS0FBQSxFQUFBO0FBQ0FBLFFBQUFBLEtBQUEsQ0FBQSxXQUFBLENBQUEsR0FBQSw0QkFBQUEsS0FBQSxDQUFBLE9BQUEsQ0FBQSxHQUFBLElBQUE7O0FBQ0EsWUFBQUMsTUFBQSxHQUFBbkIsUUFBQSxDQUFBLGNBQUEsRUFBQWtCLEtBQUEsQ0FBQSxDQUFBRSxRQUFBLENBQUFKLE9BQUEsQ0FBQTtBQUNBLE9BSEEsRUFSQSxDQWFBOztBQUNBLFVBQUFLLElBQUEsR0FBQVIsTUFBQSxDQUFBLE1BQUEsQ0FBQTtBQUNBLFVBQUFTLEtBQUEsR0FBQTlELENBQUEsQ0FBQSxPQUFBLEVBQUFzRCxPQUFBLENBQUE7QUFFQU8sTUFBQUEsSUFBQSxDQUFBSixPQUFBLENBQUEsVUFBQU0sR0FBQSxFQUFBO0FBQ0FBLFFBQUFBLEdBQUEsQ0FBQSxrQkFBQSxDQUFBLEdBQUE5RCxRQUFBLENBQUE4RCxHQUFBLENBQUEsUUFBQSxDQUFBLENBQUE7O0FBQ0EsWUFBQUMsSUFBQSxHQUFBeEIsUUFBQSxDQUFBLFlBQUEsRUFBQXVCLEdBQUEsQ0FBQSxDQUFBSCxRQUFBLENBQUFFLEtBQUEsQ0FBQTtBQUNBLE9BSEEsRUFqQkEsQ0FzQkE7O0FBQ0FoRSxNQUFBQSxHQUFBLENBQUEsU0FBQSxDQUFBLENBQUFtRSxLQUFBLEdBQUFDLE1BQUEsQ0FBQVosT0FBQTtBQUNBLEtBeEJBO0FBeUJBLEdBMUJBLENBSkEsQ0FpQ0E7OztBQUVBLFNBQUE7QUFDQU4sSUFBQUEsSUFBQSxFQUFBQTtBQURBLEdBQUE7QUFHQSxDQXRDQSxFQUFBLEMsQ0NKQTtBQUNBO0FBQ0E7OztBQUVBaEQsQ0FBQSxDQUFBLFlBQUE7QUFDQUosRUFBQUEsR0FBQSxDQUFBbUQsTUFBQSxDQUFBQyxJQUFBLENBQUEsYUFBQTtBQUNBLENBRkEsQ0FBQSIsImZpbGUiOiJtdXNpYy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuLy8gYmFzZSAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5sZXQgYXBwID0geyB9O1xyXG5cclxubGV0IHVpID0geyB9O1xyXG5sZXQgJHVpID0geyB9O1xyXG5cclxubGV0IGN1ZSA9IHsgfTtcclxuXHJcblxyXG5cclxuXHJcbi8vIFRPRE86IG1vdmVyIHBhcmEgbHVnYXIgYXByb3ByaWFkb1xyXG4kKGZ1bmN0aW9uKCkge1xyXG4gICAgJHVpW1wibGlicmFyeVwiXSA9ICQoXCIubGlicmFyeVwiKTtcclxufSk7XHJcblxyXG5jb25zdCBkdXJhdGlvbiA9IChzZWNvbmRzKSA9PiB7XHJcbiAgICByZXR1cm4gbW9tZW50LnV0Yyhtb21lbnQuZHVyYXRpb24oc2Vjb25kcywgXCJzZWNvbmRzXCIpLmFzTWlsbGlzZWNvbmRzKCkpLmZvcm1hdChcIm06c3NcIik7XHJcbn07XHJcbiIsIi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuLy8gY29yZSAvIHRlbXBsYXRlIGVuZ2luZSAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG51aS50ZW1wbGF0ZSA9ICgoKSA9PiB7XHJcbiAgICBsZXQgJHRlbXBsYXRlcyA9IHsgfTtcclxuXHJcbiAgICAkKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkKFwidGVtcGxhdGVcIikuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XHJcbiAgICAgICAgICAgIHZhciBuYW1lID0gJHRoaXMuYXR0cihcImlkXCIpO1xyXG4gICAgICAgICAgICB2YXIgaHRtbCA9ICR0aGlzLmh0bWwoKTtcclxuXHJcbiAgICAgICAgICAgICR0ZW1wbGF0ZXNbbmFtZV0gPSAkKGh0bWwpO1xyXG4gICAgICAgICAgICAkdGhpcy5yZW1vdmUoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IHJlbmRlciA9ICh0ZW1wbGF0ZSwgZGF0YSkgPT4ge1xyXG4gICAgICAgIGlmICghJHRlbXBsYXRlc1t0ZW1wbGF0ZV0pIHsgcmV0dXJuIGZhbHNlOyB9XHJcbiAgICAgICAgdmFyICRyZW5kZXIgPSAkdGVtcGxhdGVzW3RlbXBsYXRlXS5jbG9uZSgpO1xyXG5cclxuICAgICAgICAkcmVuZGVyLmRhdGEoZGF0YSk7XHJcblxyXG4gICAgICAgICQuZm4uZmlsbEJsYW5rcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyICRibGFuayA9ICQodGhpcyk7XHJcbiAgICAgICAgICAgIHZhciBmaWxsID0gJGJsYW5rLmRhdGEoXCJmaWxsXCIpO1xyXG5cclxuICAgICAgICAgICAgdmFyIHJ1bGVzID0gZmlsbC5zcGxpdChcIixcIik7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcnVsZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBwYWlyID0gcnVsZXNbaV0uc3BsaXQoXCI6XCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlc3QgPSAocGFpclsxXSA/IHBhaXJbMF0udHJpbSgpIDogXCJodG1sXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHNvdXJjZSA9IChwYWlyWzFdID8gcGFpclsxXS50cmltKCkgOiBwYWlyWzBdKTtcclxuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGRhdGFbc291cmNlXTtcclxuXHJcbiAgICAgICAgICAgICAgICBzb3VyY2UgPSBzb3VyY2Uuc3BsaXQoXCIvXCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNvdXJjZS5sZW5ndGggPiAxICYmIHR5cGVvZiB2YWx1ZSAhPT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gZGF0YVtzb3VyY2VbMF1dO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMTsgaiA8IHNvdXJjZS5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9ICh2YWx1ZVtzb3VyY2Vbal1dKSA/IHZhbHVlW3NvdXJjZVtqXV0gOiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSBcInVuZGVmaW5lZFwiICYmIHZhbHVlICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRlc3QgPT09IFwiY2xhc3NcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkYmxhbmsuYWRkQ2xhc3ModmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGVzdCA9PT0gXCJodG1sXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGJsYW5rLmh0bWwodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGVzdCA9PT0gXCJ2YWx1ZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRibGFuay52YWwodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRibGFuay5hdHRyKGRlc3QsIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZl9udWxsID0gJGJsYW5rLmRhdGEoXCJmaWxsLW51bGxcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlmX251bGwgPT09IFwiaGlkZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRibGFuay5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpZl9udWxsID09PSBcInJlbW92ZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRibGFuay5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRibGFua1xyXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiZmlsbFwiKVxyXG4gICAgICAgICAgICAgICAgLnJlbW92ZUF0dHIoXCJkYXRhLWZpbGxcIilcclxuICAgICAgICAgICAgICAgIC5yZW1vdmVBdHRyKFwiZGF0YS1maWxsLW51bGxcIik7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaWYgKCRyZW5kZXIuaGFzQ2xhc3MoXCJmaWxsXCIpKSB7XHJcbiAgICAgICAgICAgICRyZW5kZXIuZmlsbEJsYW5rcygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJChcIi5maWxsXCIsICRyZW5kZXIpLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkKHRoaXMpLmZpbGxCbGFua3MoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuICRyZW5kZXI7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICByZW5kZXJcclxuICAgIH07XHJcbn0pKCk7XHJcblxyXG5sZXQgX19yZW5kZXIgPSB1aS50ZW1wbGF0ZS5yZW5kZXI7XHJcbiIsIi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuLy8gcGxheWVyIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG4kKGZ1bmN0aW9uKCkge1xyXG4gICAgJHVpW1wicGxheWVyXCJdID0gJChcImF1ZGlvLnBsYXllclwiKVswXTtcclxuXHJcbiAgICAkdWlbXCJub3ctcGxheWluZ1wiXSA9ICQoXCIubm93LXBsYXlpbmdcIik7XHJcbiAgICAkKFwiLnBsYXlcIiwgJHVpW1wibm93LXBsYXlpbmdcIl0pLm9uKFwiY2xpY2tcIiwgYXBwLlBsYXllci50b2dnbGUpO1xyXG59KTtcclxuXHJcbmFwcC5QbGF5ZXIgPSAoKCkgPT4ge1xyXG4gICAgY29uc3QgdG9nZ2xlID0gKCkgPT4ge1xyXG4gICAgICAgIGlmICgkdWlbXCJwbGF5ZXJcIl0ucGF1c2VkKSB7XHJcbiAgICAgICAgICAgICR1aVtcInBsYXllclwiXS5wbGF5KCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgJHVpW1wicGxheWVyXCJdLnBhdXNlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHRvZ2dsZVxyXG4gICAgfTtcclxufSkoKTtcclxuIiwiLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4vLyBhcnRpc3QgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcbmFwcC5BcnRpc3QgPSAoKCkgPT4ge1xyXG5cclxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4gICAgLy8gYXBwLkFydGlzdC5sb2FkKClcclxuICAgIGNvbnN0IGxvYWQgPSAoYXJ0aXN0X2lkKSA9PiB7XHJcbiAgICAgICAgJC5nZXQoXCJkYXRhL2FydGlzdHMvXCIgKyBhcnRpc3RfaWQgKyBcIi5qc29uXCIpLmRvbmUoKHJlc3BvbnNlKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBhcnRpc3QgPSByZXNwb25zZTtcclxuICAgICAgICAgICAgbGV0ICRhcnRpc3QgPSBfX3JlbmRlcihcImFydGlzdFwiLCBhcnRpc3QpO1xyXG5cclxuICAgICAgICAgICAgLy8gw4FsYnVuc1xyXG4gICAgICAgICAgICBsZXQgYWxidW1zID0gYXJ0aXN0W1wiYWxidW1zXCJdO1xyXG4gICAgICAgICAgICBsZXQgJGFsYnVtcyA9ICQoXCIuYWxidW1zXCIsICRhcnRpc3QpO1xyXG5cclxuICAgICAgICAgICAgYWxidW1zLmZvckVhY2goKGFsYnVtKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBhbGJ1bVtcImNvdmVyLWFydFwiXSA9IFwiYmFja2dyb3VuZC1pbWFnZTogdXJsKCdcIiArIGFsYnVtW1wiY292ZXJcIl0gKyBcIicpXCI7XHJcbiAgICAgICAgICAgICAgICBsZXQgJGFsYnVtID0gX19yZW5kZXIoXCJhcnRpc3QtYWxidW1cIiwgYWxidW0pLmFwcGVuZFRvKCRhbGJ1bXMpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIEhpdHNcclxuICAgICAgICAgICAgbGV0IGhpdHMgPSBhcnRpc3RbXCJoaXRzXCJdO1xyXG4gICAgICAgICAgICBsZXQgJGhpdHMgPSAkKFwiLmhpdHNcIiwgJGFydGlzdCk7XHJcblxyXG4gICAgICAgICAgICBoaXRzLmZvckVhY2goKGhpdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaGl0W1wiZm9ybWF0dGVkLWxlbmd0aFwiXSA9IGR1cmF0aW9uKGhpdFtcImxlbmd0aFwiXSk7XHJcbiAgICAgICAgICAgICAgICBsZXQgJGhpdCA9IF9fcmVuZGVyKFwiYXJ0aXN0LWhpdFwiLCBoaXQpLmFwcGVuZFRvKCRoaXRzKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBDb2xvY2EgbmEgdGVsYVxyXG4gICAgICAgICAgICAkdWlbXCJsaWJyYXJ5XCJdLmVtcHR5KCkuYXBwZW5kKCRhcnRpc3QpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcblxyXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBsb2FkXHJcbiAgICB9O1xyXG59KSgpO1xyXG4iLCIvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbi8vIHN0YXJ0IC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuJChmdW5jdGlvbigpIHtcclxuICAgIGFwcC5BcnRpc3QubG9hZChcInRoZS1iZWF0bGVzXCIpO1xyXG59KTtcclxuIl19
